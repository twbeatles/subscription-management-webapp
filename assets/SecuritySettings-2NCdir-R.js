import{j as e,c as B,l as R,p as J,aB as _,aC as q,q as F,ay as I,x as G,n as X,X as H,aD as K,al as Q}from"./vendor-ui-B6CU6qF1.js";import{r as l}from"./vendor-react-DtEkOSI3.js";import{u as V,l as n}from"./index-XBRr7Ttx.js";function se({onLockApp:W}){const{user:f,isDemo:C,logout:j}=V(),t=C?"demo_user":f==null?void 0:f.id,[x,E]=l.useState(()=>n.getSecuritySettings(t)),[z,N]=l.useState(!1),[y,v]=l.useState(["","","",""]),[k,p]=l.useState(["","","",""]),[o,w]=l.useState("enter"),[g,L]=l.useState(!1),[b,m]=l.useState(""),[P,d]=l.useState(""),S=l.useCallback(s=>{const a={...x,...s};E(a),n.saveSecuritySettings(t,a)},[x,t]),O=(s,a,r=!1)=>{var u;if(!/^\d*$/.test(a))return;const i=r?p:v,h=r?[...k]:[...y];h[s]=a.slice(-1),i(h),a&&s<3&&((u=document.getElementById(`pin-${r?"confirm-":""}${s+1}`))==null||u.focus())},T=()=>{const s=y.join("");if(o==="enter"){if(s.length!==4){m("4자리 PIN을 입력해주세요");return}w("confirm"),m("")}else{if(s!==k.join("")){m("PIN이 일치하지 않습니다"),p(["","","",""]);return}S({pinEnabled:!0,pin:s}),N(!1),v(["","","",""]),p(["","","",""]),w("enter"),d("PIN이 설정되었습니다"),setTimeout(()=>d(""),3e3)}},D=()=>{confirm("PIN 잠금을 해제하시겠습니까?")&&(S({pinEnabled:!1,pin:null}),d("PIN 잠금이 해제되었습니다"),setTimeout(()=>d(""),3e3))},M=()=>{const s={subscriptions:n.getSubscriptions(t),settings:n.getUserSettings(t),tags:n.getTags(t),paymentMethods:n.getPaymentMethods(t),goals:n.getGoals(t),badges:n.getBadges(t),exportedAt:new Date().toISOString(),version:"3.0"},a=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),r=URL.createObjectURL(a),i=document.createElement("a");i.href=r,i.download=`subscription_backup_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(r),d("백업 파일이 다운로드되었습니다"),setTimeout(()=>d(""),3e3)},U=s=>{var i;const a=(i=s.target.files)==null?void 0:i[0];if(!a)return;const r=new FileReader;r.onload=h=>{var u;try{const c=JSON.parse((u=h.target)==null?void 0:u.result);if(!c.version||!c.subscriptions)throw new Error("Invalid");if(!confirm("현재 데이터를 백업 데이터로 교체하시겠습니까?"))return;c.subscriptions&&n.saveSubscriptions(t,c.subscriptions),c.settings&&n.saveUserSettings(t,c.settings),c.paymentMethods&&n.savePaymentMethods(t,c.paymentMethods),d("데이터가 복원되었습니다"),setTimeout(()=>window.location.reload(),2e3)}catch{m("유효하지 않은 백업 파일입니다")}},r.readAsText(a),s.target.value=""},$=()=>{confirm("정말로 모든 데이터를 삭제하시겠습니까?")&&confirm("마지막 확인입니다. 모든 데이터가 삭제됩니다.")&&(n.saveSubscriptions(t,[]),n.saveUserSettings(t,{}),n.saveSecuritySettings(t,{pinEnabled:!1,pin:null}),d("모든 데이터가 삭제되었습니다"),setTimeout(()=>{j==null||j(),window.location.reload()},2e3))},A=[{value:1,label:"1분"},{value:5,label:"5분"},{value:10,label:"10분"},{value:30,label:"30분"},{value:0,label:"사용 안 함"}];return e.jsxs("section",{className:"bg-white dark:bg-dark-800 p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-dark-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-5",children:e.jsxs("h3",{className:"font-bold text-gray-900 dark:text-white flex items-center gap-2.5 text-base",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-50 dark:bg-red-900/20 text-red-500",children:e.jsx(B,{className:"w-5 h-5"})}),"보안 & 개인정보"]})}),P&&e.jsxs("div",{className:"mb-4 p-3 bg-green-50 rounded-xl flex items-center gap-2 text-green-600 text-sm",children:[e.jsx(R,{size:16}),P]}),b&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 rounded-xl flex items-center gap-2 text-red-600 text-sm",children:[e.jsx(J,{size:16}),b]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-dark-700/50 rounded-2xl",children:e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-xl ${x.pinEnabled?"bg-green-100":"bg-gray-200"}`,children:x.pinEnabled?e.jsx(_,{size:18,className:"text-green-600"}):e.jsx(q,{size:18,className:"text-gray-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm text-gray-800 dark:text-white",children:"PIN 잠금"}),e.jsx("p",{className:"text-xs text-gray-400",children:"앱 실행 시 4자리 PIN 입력"})]})]}),x.pinEnabled?e.jsx("button",{onClick:D,className:"px-3 py-1.5 bg-red-100 text-red-600 text-xs font-medium rounded-lg",children:"해제"}):e.jsx("button",{onClick:()=>N(!0),className:"px-3 py-1.5 bg-primary-500 text-white text-xs font-medium rounded-lg",children:"설정"})]})}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-dark-700/50 rounded-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 rounded-xl bg-blue-100",children:e.jsx(F,{size:18,className:"text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm text-gray-800 dark:text-white",children:"자동 잠금"}),e.jsx("p",{className:"text-xs text-gray-400",children:"일정 시간 후 자동 잠금"})]})]}),e.jsx("div",{className:"flex gap-2",children:A.map(s=>e.jsx("button",{onClick:()=>S({autoLockMinutes:s.value}),className:`flex-1 py-2 rounded-xl text-xs font-medium ${x.autoLockMinutes===s.value?"bg-primary-500 text-white":"bg-white dark:bg-dark-600 text-gray-600"}`,children:s.label},s.value))})]}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-dark-700/50 rounded-2xl",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 rounded-xl bg-purple-100",children:e.jsx(I,{size:18,className:"text-purple-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm text-gray-800 dark:text-white",children:"백업 & 복원"}),e.jsx("p",{className:"text-xs text-gray-400",children:"JSON 파일로 백업"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:M,className:"flex-1 py-2.5 bg-purple-500 text-white rounded-xl text-xs font-medium flex items-center justify-center gap-1",children:[e.jsx(I,{size:14}),"백업"]}),e.jsxs("label",{className:"flex-1",children:[e.jsx("input",{type:"file",accept:".json",onChange:U,className:"hidden"}),e.jsxs("div",{className:"py-2.5 bg-white dark:bg-dark-600 text-gray-700 rounded-xl text-xs font-medium flex items-center justify-center gap-1 cursor-pointer",children:[e.jsx(G,{size:14}),"복원"]})]})]})]}),e.jsxs("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 rounded-2xl border border-red-200",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 rounded-xl bg-red-100",children:e.jsx(X,{size:18,className:"text-red-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm text-red-700",children:"모든 데이터 삭제"}),e.jsx("p",{className:"text-xs text-red-500/70",children:"모든 데이터가 영구 삭제됩니다"})]})]}),e.jsx("button",{onClick:$,className:"w-full py-2.5 bg-red-600 text-white rounded-xl text-xs font-medium",children:"모든 데이터 삭제"})]})]}),z&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-3xl max-w-sm w-full p-6 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"font-bold text-lg",children:o==="enter"?"PIN 설정":"PIN 확인"}),e.jsx("button",{onClick:()=>{N(!1),v(["","","",""]),p(["","","",""]),w("enter"),m("")},children:e.jsx(H,{size:20,className:"text-gray-400"})})]}),e.jsx("p",{className:"text-sm text-gray-500 text-center mb-6",children:o==="enter"?"4자리 PIN을 입력해주세요":"PIN을 다시 입력해주세요"}),e.jsx("div",{className:"flex justify-center gap-3 mb-6",children:(o==="enter"?y:k).map((s,a)=>e.jsx("input",{id:`pin-${o==="confirm"?"confirm-":""}${a}`,type:g?"text":"password",value:s,onChange:r=>O(a,r.target.value,o==="confirm"),maxLength:1,className:"w-14 h-14 text-center text-2xl font-bold bg-gray-100 rounded-xl outline-none focus:ring-2 focus:ring-primary-500"},a))}),e.jsxs("button",{onClick:()=>L(!g),className:"flex items-center justify-center gap-2 text-sm text-gray-500 mb-6 mx-auto",children:[g?e.jsx(K,{size:16}):e.jsx(Q,{size:16}),g?"PIN 숨기기":"PIN 보기"]}),b&&e.jsx("p",{className:"text-sm text-red-500 text-center mb-4",children:b}),e.jsx("button",{onClick:T,className:"w-full py-3 bg-primary-600 text-white font-medium rounded-xl",children:o==="enter"?"다음":"PIN 설정 완료"})]})})]})}export{se as default};
