import{j as e,t as S,u as q,k as A,aE as F,_ as C,n as K,y as B}from"./vendor-ui-B6CU6qF1.js";import{r as m}from"./vendor-react-DtEkOSI3.js";import{u as G,h as H,l as y}from"./index-XBRr7Ttx.js";function Y({subscriptions:j,onUpdateSubscription:J}){const{user:b,isDemo:P}=G(),l=P?"demo_user":b==null?void 0:b.id,[Q,R]=m.useState(null),[_,E]=m.useState(null),[p,w]=m.useState(""),{confirm:v,ConfirmModalComponent:z}=H(),[h,f]=m.useState(()=>y.getSharedMembers(l)),u=m.useCallback(r=>{f(r),y.saveSharedMembers(l,r)},[l]);m.useEffect(()=>{const r=a=>{a.key===`sub_manager_shared_members_${l}`&&f(y.getSharedMembers(l))},s=a=>{var n;((n=a.detail)==null?void 0:n.userId)===l&&f(a.detail.members)};return window.addEventListener("storage",r),window.addEventListener("sub_manager_shared_members_updated",s),()=>{window.removeEventListener("storage",r),window.removeEventListener("sub_manager_shared_members_updated",s)}},[l]);const N=m.useMemo(()=>j.filter(r=>!r.isPaused),[j]),g=r=>h[r]||[{id:"owner",name:"나 (본인)",isOwner:!0,sharePercent:100}],M=r=>{if(!p.trim())return;const s=g(r),a={id:`member_${Date.now()}`,name:p.trim(),isOwner:!1,sharePercent:0},n={...h,[r]:[...s,a]};u(n),w("")},O=async(r,s)=>{const a=g(r);if(a.length<=1)return;const n=a.find(c=>c.id===s);if(!await v({title:"멤버 삭제",message:`${(n==null?void 0:n.name)||"이 멤버"}를 삭제하시겠습니까? 비용 분담 비율이 재조정됩니다.`,confirmText:"삭제",cancelText:"취소",isDanger:!0}))return;const x=a.filter(c=>c.id!==s),t=Math.floor(100/x.length),o=100-t*x.length,d=x.map((c,k)=>({...c,sharePercent:k===0?t+o:t}));u({...h,[r]:d})},D=(r,s,a)=>{const n=g(r),x=100-n.filter(d=>d.id!==s).reduce((d,c)=>d+c.sharePercent,0),t=Math.max(0,Math.min(x,a)),o=n.map(d=>d.id===s?{...d,sharePercent:t}:d);u({...h,[r]:o})},L=(r,s)=>{const n=g(r).map(i=>i.id===s?{...i,isOwner:!i.isOwner}:i);u({...h,[r]:n})},T=(r,s)=>g(r).map(n=>({...n,amount:Math.round(s.cost*n.sharePercent/100)}));return e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"bg-white dark:bg-dark-800 rounded-3xl shadow-sm border border-gray-100 dark:border-dark-700 overflow-hidden",children:[e.jsx("div",{className:"p-5 border-b border-gray-100 dark:border-dark-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-cyan-500 to-blue-600 rounded-2xl flex items-center justify-center shadow-lg shadow-cyan-500/30",children:e.jsx(S,{size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-white",children:"공유 멤버 관리"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-dark-400",children:"구독별 공유 멤버와 비용 분담"})]})]})}),e.jsx("div",{className:"p-5 space-y-4",children:N.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-dark-400",children:[e.jsx(S,{size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"활성화된 구독이 없습니다"})]}):N.map(r=>{const s=g(r.id),a=_===r.id,n=T(r.id,r),i=s.length>1,x=async()=>{if(!await v({title:"비율 균등 분배",message:"모든 멤버의 분담 비율을 균등하게 재설정하시겠습니까?",confirmText:"균등 분배",cancelText:"취소",isDanger:!1}))return;const o=s.length,d=Math.floor(100/o),c=100-d*o,k=s.map((U,$)=>({...U,sharePercent:$===0?d+c:d}));u({...h,[r.id]:k})};return e.jsxs("div",{className:"border border-gray-200 dark:border-dark-600 rounded-2xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>E(a?null:r.id),className:"w-full p-4 flex items-center justify-between bg-gray-50 dark:bg-dark-700 hover:bg-gray-100 dark:hover:bg-dark-600 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center text-white font-bold text-sm shadow-md",style:{backgroundColor:r.customColor||"#6366F1"},children:r.name.slice(0,1).toUpperCase()}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white",children:r.name}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-dark-400 flex items-center gap-2",children:[e.jsxs("span",{children:[r.cost.toLocaleString(),"원/월"]}),e.jsx("span",{children:"•"}),e.jsxs("span",{className:"text-cyan-600 dark:text-cyan-400",children:[s.length,"명 공유"]})]})]})]}),a?e.jsx(q,{size:18}):e.jsx(A,{size:18})]}),a&&e.jsxs("div",{className:"p-4 space-y-4 border-t border-gray-200 dark:border-dark-600",children:[e.jsx("div",{className:"space-y-2",children:n.map(t=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 dark:bg-dark-700 rounded-xl",children:[e.jsx("button",{onClick:()=>t.id!=="owner"&&L(r.id,t.id),className:`p-1.5 rounded-lg transition-colors ${t.isOwner?"bg-amber-100 text-amber-600 dark:bg-amber-900/30 dark:text-amber-400":"bg-gray-200 text-gray-400 dark:bg-dark-600 hover:bg-gray-300"}`,title:t.isOwner?"관리자":"일반 멤버",children:e.jsx(F,{size:14})}),e.jsx("span",{className:"flex-1 font-medium text-sm text-gray-800 dark:text-white",children:t.name}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("input",{type:"number",value:t.sharePercent,onChange:o=>D(r.id,t.id,parseInt(o.target.value)||0),min:"0",max:"100",className:"w-14 px-2 py-1 text-center bg-white dark:bg-dark-600 border border-gray-200 dark:border-dark-500 rounded-lg text-sm"}),e.jsx(C,{size:12,className:"text-gray-400"})]}),e.jsx("div",{className:"text-right min-w-[70px]",children:e.jsxs("span",{className:"text-sm font-bold text-cyan-600 dark:text-cyan-400",children:[t.amount.toLocaleString(),"원"]})}),t.id!=="owner"&&e.jsx("button",{onClick:()=>O(r.id,t.id),className:"p-1.5 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:e.jsx(K,{size:14})})]},t.id))}),i&&e.jsx("div",{className:"flex justify-end",children:e.jsxs("button",{onClick:x,className:"text-xs text-gray-500 hover:text-cyan-600 dark:text-dark-400 dark:hover:text-cyan-400 flex items-center gap-1 transition-colors",children:[e.jsx(C,{size:12}),"비율 균등 분배 (1/N)"]})}),(()=>{const t=s.reduce((o,d)=>o+d.sharePercent,0);return t!==100?e.jsxs("div",{className:"p-2 bg-amber-50 dark:bg-amber-900/10 rounded-lg text-xs text-amber-700 dark:text-amber-400 text-center",children:["⚠️ 비율 합계: ",t,"% (100%가 되어야 합니다)"]}):null})(),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:p,onChange:t=>w(t.target.value),onKeyDown:t=>t.key==="Enter"&&M(r.id),placeholder:"새 멤버 이름",className:"flex-1 px-4 py-2.5 bg-white dark:bg-dark-600 border border-gray-200 dark:border-dark-500 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-cyan-500/50"}),e.jsxs("button",{onClick:()=>M(r.id),className:"px-4 py-2.5 bg-cyan-500 hover:bg-cyan-600 text-white rounded-xl text-sm font-medium flex items-center gap-1.5 transition-colors",children:[e.jsx(B,{size:16}),"추가"]})]})]})]},r.id)})})]}),z]})}export{Y as default};
