import{j as e,a3 as C,ac as _,as as q,at as A,T as J,X as G,s as K,l as Q,ap as V}from"./vendor-ui-B6CU6qF1.js";import{r as l}from"./vendor-react-DtEkOSI3.js";import{u as W,l as i,e as Y,B as M,f as P}from"./index-XBRr7Ttx.js";function re({subscriptions:o,totalMonthlyCost:ee}){const{user:b,isDemo:z}=W(),r=z?"demo_user":b==null?void 0:b.id,[c,N]=l.useState(()=>i.getGoals(r)),[x,B]=l.useState(()=>i.getBadges(r)),[u,E]=l.useState(()=>i.getChallenges(r)),[m,T]=l.useState(()=>i.getUserStats(r)),[$,f]=l.useState(!1),[d,p]=l.useState({name:"",targetAmount:"",description:""}),[h,I]=l.useState("goals"),[y,k]=l.useState(null),v=l.useRef(!0),g=l.useMemo(()=>o.filter(s=>s.isPaused).reduce((s,a)=>s+(Y(a)||0),0),[o]);l.useEffect(()=>{if(v.current){v.current=!1;return}const t=o.filter(n=>!n.isPaused).length,s=o.filter(n=>n.paymentMethodId).length,a={totalSubscriptions:o.length,activeSubscriptions:t,totalSaved:g,linkedPaymentMethods:s};T(n=>({...n,...a})),i.saveUserStats(r,a)},[o.length,g,r]),l.useEffect(()=>{if(!m||!m.totalSubscriptions)return;let t=!1,s=null;return Object.values(M).forEach(a=>{x.find(n=>n.id===a.id)||a.condition(m)&&(i.addBadge(r,a.id),t||(k(a),s=setTimeout(()=>k(null),3e3),t=!0))}),t&&B(i.getBadges(r)),()=>{s&&clearTimeout(s)}},[m.totalSubscriptions,m.activeSubscriptions,r,x]);const{xp:w,level:L,progress:X}=l.useMemo(()=>{const t=x.length*100,s=u.filter(j=>j.completed).reduce((j,Z)=>{var S;return j+(((S=P[Z.challengeId])==null?void 0:S.xp)||0)},0),a=t+s,n=Math.floor(a/500)+1,H=a%500/500*100;return{xp:a,level:n,progress:H}},[x,u]),U=l.useCallback(()=>{if(!d.name||!d.targetAmount)return;const t=i.addGoal(r,{name:d.name,targetAmount:parseInt(d.targetAmount),description:d.description,type:"savings"});N([...c,t]),p({name:"",targetAmount:"",description:""}),f(!1)},[d,c,r]),D=l.useCallback(t=>{i.deleteGoal(r,t),N(c.filter(s=>s.id!==t))},[c,r]),O=l.useCallback(t=>{i.startChallenge(r,t),E(i.getChallenges(r))},[r]),F=t=>{const s=Math.min(100,g/t.targetAmount*100);return Math.round(s)},R=[{key:"goals",label:"목표",icon:C},{key:"badges",label:"배지",icon:q},{key:"challenges",label:"챌린지",icon:A}];return e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"bg-white dark:bg-dark-800 p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-dark-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsxs("h3",{className:"font-bold text-gray-900 dark:text-white flex items-center gap-2.5 text-base",children:[e.jsx("div",{className:"p-2 rounded-lg bg-yellow-50 dark:bg-yellow-900/20 text-yellow-500",children:e.jsx(C,{className:"w-5 h-5"})}),"목표 & 성장"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1 px-3 py-1.5 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full text-white",children:[e.jsx(_,{size:12,fill:"white"}),e.jsxs("span",{className:"text-xs font-bold",children:["Lv.",L]})]}),e.jsx("div",{className:"text-right",children:e.jsxs("p",{className:"text-[10px] text-gray-400",children:[w," XP"]})})]})]}),e.jsxs("div",{className:"mb-5",children:[e.jsx("div",{className:"h-2 bg-gray-100 dark:bg-dark-700 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-purple-500 to-pink-500 transition-all duration-500",style:{width:`${X}%`}})}),e.jsxs("p",{className:"text-[10px] text-gray-400 mt-1 text-right",children:["다음 레벨까지 ",500-w%500," XP"]})]}),e.jsx("div",{className:"flex gap-2 mb-4",children:R.map(t=>e.jsxs("button",{onClick:()=>I(t.key),className:`flex-1 flex items-center justify-center gap-1.5 py-2.5 rounded-xl text-xs font-medium transition-all ${h===t.key?"bg-primary-500 text-white shadow-md":"bg-gray-100 dark:bg-dark-700 text-gray-600 dark:text-dark-300"}`,children:[e.jsx(t.icon,{size:14}),t.label]},t.key))}),h==="goals"&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-4 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-green-600/70",children:"총 절약 금액"}),e.jsxs("p",{className:"text-2xl font-bold text-green-700 dark:text-green-400",children:["₩",g.toLocaleString()]})]}),e.jsx(J,{className:"text-green-500",size:32})]})}),c.map(t=>{const s=F(t);return e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-dark-700/50 rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm text-gray-800 dark:text-white",children:t.name}),e.jsx("p",{className:"text-xs text-gray-400",children:t.description})]}),e.jsx("button",{onClick:()=>D(t.id),className:"p-1 text-gray-400 hover:text-red-500",children:e.jsx(G,{size:14})})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1 h-2 bg-gray-200 dark:bg-dark-600 rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full transition-all duration-500 ${s>=100?"bg-gradient-to-r from-green-400 to-emerald-500":"bg-gradient-to-r from-primary-400 to-primary-600"}`,style:{width:`${s}%`}})}),e.jsxs("span",{className:"text-xs font-bold text-gray-600 dark:text-dark-300 min-w-[40px] text-right",children:[s,"%"]})]}),e.jsxs("p",{className:"text-[10px] text-gray-400 mt-2",children:["목표: ₩",t.targetAmount.toLocaleString()," / 현재: ₩",g.toLocaleString()]})]},t.id)}),e.jsxs("button",{onClick:()=>f(!0),className:"w-full p-4 border-2 border-dashed border-gray-200 dark:border-dark-600 rounded-2xl text-gray-400 hover:text-primary-500 hover:border-primary-300 transition-all flex items-center justify-center gap-2",children:[e.jsx(K,{size:16}),e.jsx("span",{className:"text-sm",children:"새 목표 추가"})]})]}),h==="badges"&&e.jsx("div",{className:"grid grid-cols-3 gap-3",children:Object.values(M).map(t=>{const s=x.find(a=>a.id===t.id);return e.jsxs("div",{className:`p-4 rounded-2xl text-center transition-all ${s?"bg-gradient-to-br from-yellow-50 to-orange-50 dark:from-yellow-900/20 dark:to-orange-900/20 border-2 border-yellow-200 dark:border-yellow-800":"bg-gray-100 dark:bg-dark-700 opacity-50"}`,children:[e.jsx("span",{className:"text-3xl",children:t.icon}),e.jsx("p",{className:`text-[10px] font-bold mt-2 ${s?"text-gray-800 dark:text-white":"text-gray-400"}`,children:t.name}),e.jsx("p",{className:"text-[8px] text-gray-400 mt-1",children:t.description}),s&&e.jsx("p",{className:"text-[8px] text-green-500 mt-1",children:"✓ 획득함"})]},t.id)})}),h==="challenges"&&e.jsx("div",{className:"space-y-3",children:Object.values(P).map(t=>{const s=u.find(n=>n.challengeId===t.id&&!n.completed),a=u.find(n=>n.challengeId===t.id&&n.completed);return e.jsxs("div",{className:`p-4 rounded-2xl ${a?"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800":s?"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800":"bg-gray-50 dark:bg-dark-700/50"}`,children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`p-2 rounded-xl ${a?"bg-green-100 dark:bg-green-800/30 text-green-600":s?"bg-yellow-100 dark:bg-yellow-800/30 text-yellow-600":"bg-gray-200 dark:bg-dark-600 text-gray-500"}`,children:a?e.jsx(Q,{size:16}):e.jsx(A,{size:16})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm text-gray-800 dark:text-white",children:t.name}),e.jsx("p",{className:"text-xs text-gray-400",children:t.description})]})]}),!s&&!a&&e.jsx("button",{onClick:()=>O(t.id),className:"px-3 py-1.5 bg-primary-500 text-white text-xs font-medium rounded-lg hover:bg-primary-600 transition-colors",children:"시작"}),s&&e.jsx("span",{className:"text-xs text-yellow-600 font-medium",children:"진행중"}),a&&e.jsx("span",{className:"text-xs text-green-600 font-medium",children:"완료!"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-3 text-[10px] text-gray-400",children:[e.jsxs("span",{children:[t.duration,"일 챌린지"]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(V,{size:10,className:"text-purple-500"}),"+",t.xp," XP"]})]})]},t.id)})})]}),$&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-3xl max-w-sm w-full p-6 shadow-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 dark:text-white",children:"새 저축 목표"}),e.jsx("button",{onClick:()=>f(!1),className:"p-2",children:e.jsx(G,{size:20,className:"text-gray-400"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"목표 이름"}),e.jsx("input",{type:"text",value:d.name,onChange:t=>p({...d,name:t.target.value}),placeholder:"예: 제주도 여행",className:"w-full px-4 py-3 bg-gray-100 dark:bg-dark-700 rounded-xl text-sm outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"목표 금액 (원)"}),e.jsx("input",{type:"number",value:d.targetAmount,onChange:t=>p({...d,targetAmount:t.target.value}),placeholder:"예: 500000",className:"w-full px-4 py-3 bg-gray-100 dark:bg-dark-700 rounded-xl text-sm outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"설명 (선택)"}),e.jsx("input",{type:"text",value:d.description,onChange:t=>p({...d,description:t.target.value}),placeholder:"예: Netflix 해지하면 6개월 후 달성!",className:"w-full px-4 py-3 bg-gray-100 dark:bg-dark-700 rounded-xl text-sm outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsx("button",{onClick:U,disabled:!d.name||!d.targetAmount,className:"w-full py-3 bg-primary-600 hover:bg-primary-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-medium rounded-xl transition-colors",children:"목표 추가"})]})]})}),y&&e.jsxs("div",{className:"fixed top-20 left-1/2 -translate-x-1/2 z-50 bg-gradient-to-r from-yellow-400 to-orange-500 text-white px-6 py-4 rounded-2xl shadow-2xl flex items-center gap-3 animate-bounce",children:[e.jsx("span",{className:"text-3xl",children:y.icon}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"새 배지 획득!"}),e.jsx("p",{className:"text-sm opacity-90",children:y.name})]})]})]})}export{re as default};
