import{j as e,C as b,s as L,u as A,k as T,r as O,X as C,l as $,au as Y,av as H,W as R}from"./vendor-ui-B6CU6qF1.js";import{r as c}from"./vendor-react-DtEkOSI3.js";import{u as W,l as h,h as X,i as v,j as q}from"./index-XBRr7Ttx.js";const G={CreditCard:b,Wallet:R,Smartphone:H,Building:Y};function V({subscriptions:m,onUpdateSubscription:p}){const{user:N,isDemo:D}=W(),n=D?"demo_user":N==null?void 0:N.id,[d,g]=c.useState(()=>h.getPaymentMethods(n)),[M,u]=c.useState(!1),[x,y]=c.useState(null),[F,E]=c.useState(null),[a,o]=c.useState({name:"",type:"credit",billingDay:15,color:"#3B82F6",lastFourDigits:""}),{confirm:w,ConfirmModalComponent:P}=X();c.useEffect(()=>{const t=s=>{s.key===`sub_manager_payment_methods_${n}`&&g(h.getPaymentMethods(n))},l=s=>{var r;((r=s.detail)==null?void 0:r.userId)===n&&g(s.detail.methods)};return window.addEventListener("storage",t),window.addEventListener("sub_manager_payment_methods_updated",l),()=>{window.removeEventListener("storage",t),window.removeEventListener("sub_manager_payment_methods_updated",l)}},[n]);const j=c.useMemo(()=>{const t={};d.forEach(s=>{const r=m.filter(i=>i.paymentMethodId===s.id&&!i.isPaused),f=r.reduce((i,k)=>i+(k.cost||0),0);t[s.id]={subscriptions:r,count:r.length,totalCost:f}});const l=m.filter(s=>!s.paymentMethodId&&!s.isPaused);return t.unassigned={subscriptions:l,count:l.length,totalCost:l.reduce((s,r)=>s+(r.cost||0),0)},t},[m,d]),_=c.useCallback(()=>{var l;if(!a.name)return;const t={...a,billingDay:Math.max(1,Math.min(31,parseInt(a.billingDay)||15)),lastFourDigits:((l=a.lastFourDigits)==null?void 0:l.replace(/\D/g,"").slice(0,4))||""};if(x){const s=h.updatePaymentMethod(n,x.id,t);g(d.map(r=>r.id===x.id?s:r))}else{const s=h.addPaymentMethod(n,t);g([...d,s])}o({name:"",type:"credit",billingDay:15,color:"#3B82F6",lastFourDigits:""}),u(!1),y(null)},[a,x,d,n]),S=c.useCallback(async t=>{await w({title:"결제수단 삭제",message:"이 결제수단을 삭제하시겠습니까? 연결된 구독의 결제수단은 해제됩니다.",confirmText:"삭제",cancelText:"취소",isDanger:!0})&&(h.deletePaymentMethod(n,t),g(d.filter(s=>s.id!==t)),m.forEach(s=>{s.paymentMethodId===t&&(p==null||p(s.id,{paymentMethodId:null}))}))},[d,m,n,p,w]),z=t=>{o({name:t.name,type:t.type,billingDay:t.billingDay||15,color:t.color||"#3B82F6",lastFourDigits:t.lastFourDigits||""}),y(t),u(!0)},I=t=>{o({...a,name:t.name,type:t.type,color:t.color})},B=t=>{var r;const l=((r=v[t])==null?void 0:r.icon)||"CreditCard";return G[l]||b};return e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"bg-white dark:bg-dark-800 p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-dark-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsxs("h3",{className:"font-bold text-gray-900 dark:text-white flex items-center gap-2.5 text-base",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-50 dark:bg-blue-900/20 text-blue-500",children:e.jsx(b,{className:"w-5 h-5"})}),"결제 수단 관리"]}),e.jsxs("button",{onClick:()=>{y(null),o({name:"",type:"credit",billingDay:15,color:"#3B82F6",lastFourDigits:""}),u(!0)},className:"flex items-center gap-1 px-3 py-1.5 bg-blue-500 text-white text-xs font-medium rounded-lg hover:bg-blue-600 transition-colors",children:[e.jsx(L,{size:14}),"추가"]})]}),d.length===0?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx(b,{className:"mx-auto text-gray-300 dark:text-dark-600 mb-3",size:48}),e.jsx("p",{className:"text-sm text-gray-400 dark:text-dark-500",children:"등록된 결제수단이 없습니다"}),e.jsx("button",{onClick:()=>u(!0),className:"mt-3 text-sm text-primary-500 hover:text-primary-600",children:"결제수단 추가하기"})]}):e.jsxs("div",{className:"space-y-2",children:[d.map(t=>{var f;const l=B(t.type),s=j[t.id]||{count:0,totalCost:0,subscriptions:[]},r=F===t.id;return e.jsxs("div",{className:"rounded-2xl overflow-hidden",children:[e.jsxs("button",{onClick:()=>E(r?null:t.id),className:"w-full flex items-center gap-4 p-4 bg-gray-50 dark:bg-dark-700/50 hover:bg-gray-100 dark:hover:bg-dark-700 transition-colors",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl flex items-center justify-center text-white",style:{backgroundColor:t.color||"#3B82F6"},children:e.jsx(l,{size:24})}),e.jsxs("div",{className:"flex-1 text-left",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"font-medium text-sm text-gray-800 dark:text-white",children:t.name}),t.lastFourDigits&&e.jsxs("span",{className:"text-xs text-gray-400",children:["····",t.lastFourDigits]})]}),e.jsxs("p",{className:"text-xs text-gray-400",children:[(f=v[t.type])==null?void 0:f.label," · 결제일 ",t.billingDay,"일"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-sm text-gray-800 dark:text-white",children:["₩",s.totalCost.toLocaleString()]}),e.jsxs("p",{className:"text-xs text-gray-400",children:[s.count,"개 구독"]})]}),r?e.jsx(A,{size:16,className:"text-gray-400"}):e.jsx(T,{size:16,className:"text-gray-400"})]}),r&&e.jsxs("div",{className:"p-4 bg-gray-100 dark:bg-dark-700 border-t border-gray-200 dark:border-dark-600",children:[e.jsxs("div",{className:"flex gap-2 mb-4",children:[e.jsxs("button",{onClick:()=>z(t),className:"flex items-center gap-1 px-3 py-1.5 bg-white dark:bg-dark-600 text-gray-600 dark:text-dark-200 text-xs rounded-lg hover:bg-gray-50 dark:hover:bg-dark-500 transition-colors",children:[e.jsx(O,{size:12}),"수정"]}),e.jsxs("button",{onClick:()=>S(t.id),className:"flex items-center gap-1 px-3 py-1.5 bg-red-50 dark:bg-red-900/20 text-red-600 text-xs rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 transition-colors",children:[e.jsx(C,{size:12}),"삭제"]})]}),s.subscriptions.length>0?e.jsxs("div",{className:"space-y-2",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-dark-400 mb-2",children:"연결된 구독"}),s.subscriptions.map(i=>{var k;return e.jsxs("div",{className:"flex items-center justify-between p-2 bg-white dark:bg-dark-800 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-6 h-6 rounded-md flex items-center justify-center text-white text-[10px] font-bold",style:{backgroundColor:i.color||"#6366F1"},children:(k=i.name)==null?void 0:k.charAt(0)}),e.jsx("span",{className:"text-xs font-medium text-gray-700 dark:text-dark-200",children:i.name})]}),e.jsxs("span",{className:"text-xs text-gray-500",children:["₩",(i.cost||0).toLocaleString()]})]},i.id)})]}):e.jsx("p",{className:"text-xs text-gray-400 text-center py-4",children:"연결된 구독이 없습니다"})]})]},t.id)}),j.unassigned.count>0&&e.jsx("div",{className:"p-4 bg-orange-50 dark:bg-orange-900/20 rounded-2xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 bg-orange-100 dark:bg-orange-800/30 rounded-lg flex items-center justify-center",children:e.jsx(b,{size:16,className:"text-orange-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-orange-700 dark:text-orange-400",children:"결제수단 미지정"}),e.jsxs("p",{className:"text-xs text-orange-500/70",children:[j.unassigned.count,"개 구독"]})]})]}),e.jsxs("span",{className:"text-sm font-bold text-orange-600",children:["₩",j.unassigned.totalCost.toLocaleString()]})]})})]})]}),M&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-3xl max-w-sm w-full shadow-2xl overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-gray-100 dark:border-dark-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800 dark:text-white",children:x?"결제수단 수정":"결제수단 추가"}),e.jsx("button",{onClick:()=>{u(!1),y(null)},className:"p-2",children:e.jsx(C,{size:20,className:"text-gray-400"})})]})}),e.jsxs("div",{className:"p-6 space-y-4 max-h-[60vh] overflow-y-auto",children:[!x&&e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 mb-2 block",children:"빠른 선택"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:q.slice(0,6).map(t=>e.jsx("button",{onClick:()=>I(t),className:`px-3 py-1.5 rounded-lg text-xs font-medium transition-all ${a.name===t.name?"bg-primary-500 text-white":"bg-gray-100 dark:bg-dark-700 text-gray-600 dark:text-dark-300"}`,children:t.name},t.name))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"결제수단 이름"}),e.jsx("input",{type:"text",value:a.name,onChange:t=>o({...a,name:t.target.value}),placeholder:"예: 삼성카드",className:"w-full px-4 py-3 bg-gray-100 dark:bg-dark-700 rounded-xl text-sm outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 mb-2 block",children:"유형"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(v).map(([t,l])=>e.jsxs("button",{onClick:()=>o({...a,type:t}),className:`p-3 rounded-xl text-xs font-medium transition-all flex items-center gap-2 ${a.type===t?"bg-primary-500 text-white":"bg-gray-100 dark:bg-dark-700 text-gray-600 dark:text-dark-300"}`,children:[a.type===t&&e.jsx($,{size:14}),l.label]},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"결제일"}),e.jsx("input",{type:"number",min:"1",max:"31",value:a.billingDay,onChange:t=>o({...a,billingDay:parseInt(t.target.value)||1}),className:"w-full px-4 py-3 bg-gray-100 dark:bg-dark-700 rounded-xl text-sm outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 mb-1 block",children:"카드 끝 4자리 (선택)"}),e.jsx("input",{type:"text",maxLength:"4",value:a.lastFourDigits,onChange:t=>o({...a,lastFourDigits:t.target.value.replace(/\D/g,"")}),placeholder:"1234",className:"w-full px-4 py-3 bg-gray-100 dark:bg-dark-700 rounded-xl text-sm outline-none focus:ring-2 focus:ring-primary-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-gray-500 mb-2 block",children:"색상"}),e.jsx("div",{className:"flex gap-2",children:["#3B82F6","#10B981","#8B5CF6","#F59E0B","#EF4444","#000000"].map(t=>e.jsx("button",{onClick:()=>o({...a,color:t}),className:`w-8 h-8 rounded-full transition-transform ${a.color===t?"ring-2 ring-offset-2 ring-primary-500 scale-110":""}`,style:{backgroundColor:t}},t))})]})]}),e.jsx("div",{className:"p-6 border-t border-gray-100 dark:border-dark-700",children:e.jsx("button",{onClick:_,disabled:!a.name,className:"w-full py-3 bg-primary-600 hover:bg-primary-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white font-medium rounded-xl transition-colors",children:x?"수정하기":"추가하기"})})]})}),P]})}export{V as default};
