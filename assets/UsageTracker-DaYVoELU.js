import{j as t,ar as R,p as $,l as z,u as F,k as I}from"./vendor-ui-B6CU6qF1.js";import{r as o}from"./vendor-react-DtEkOSI3.js";import{u as O,l as j,U as P}from"./index-XBRr7Ttx.js";function H({subscriptions:m}){const{user:h,isDemo:N}=O(),g=N?"demo_user":h==null?void 0:h.id,[u,w]=o.useState(null),[p,v]=o.useState(()=>j.getUsageRecords(g)),[y,S]=o.useState([]),x=new Date().toISOString().split("T")[0],k=o.useMemo(()=>m.filter(e=>!e.isPaused).map(e=>{var b;const a=p[e.id]||[],l=a.filter(E=>{const M=new Date(E),f=new Date;return f.setDate(f.getDate()-30),M>=f}),n=((b=P[e.usageFrequency||"weekly"])==null?void 0:b.value)||8,c=l.length,s=Math.min(100,Math.round(c/n*100));let r="normal";s<30?r="low":s<60?r="medium":s>=80&&(r="high");const i=a.length>0?new Date(a[a.length-1]):null,L=i?Math.floor((new Date-i)/(1e3*60*60*24)):null;return{...e,usageScore:s,status:r,last30DaysCount:l.length,lastUsed:i,daysSinceLastUse:L,records:l,checkedToday:a.includes(x)||y.includes(e.id)}}).sort((e,a)=>e.usageScore-a.usageScore),[m,p,y,x]),d=k.filter(e=>e.status==="low"||e.daysSinceLastUse!==null&&e.daysSinceLastUse>30),U=o.useMemo(()=>d.reduce((e,a)=>e+(a.cost||0),0),[d]),D=o.useCallback(e=>{j.recordUsage(g,e,x),v(j.getUsageRecords(g)),S(a=>[...a,e])},[g,x]),C=e=>{const a=[],l=new Date;for(let n=11;n>=0;n--){const c=[];for(let s=6;s>=0;s--){const r=new Date(l);r.setDate(r.getDate()-(n*7+s));const i=r.toISOString().split("T")[0];c.push({date:i,active:e.includes(i)})}a.push(c)}return a},T=e=>e>=80?"text-green-500 bg-green-50 dark:bg-green-900/20":e>=60?"text-blue-500 bg-blue-50 dark:bg-blue-900/20":e>=30?"text-yellow-500 bg-yellow-50 dark:bg-yellow-900/20":"text-red-500 bg-red-50 dark:bg-red-900/20",A=e=>{switch(e){case"high":return"활발";case"medium":return"보통";case"low":return"저조";default:return"보통"}};return m.filter(e=>!e.isPaused).length===0?null:t.jsxs("section",{className:"bg-white dark:bg-dark-800 p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-dark-700",children:[t.jsxs("div",{className:"flex items-center justify-between mb-5",children:[t.jsxs("h3",{className:"font-bold text-gray-900 dark:text-white flex items-center gap-2.5 text-base",children:[t.jsx("div",{className:"p-2 rounded-lg bg-purple-50 dark:bg-purple-900/20 text-purple-500",children:t.jsx(R,{className:"w-5 h-5"})}),"사용 빈도 추적"]}),t.jsxs("span",{className:"text-xs text-gray-400",children:["오늘 ",x]})]}),d.length>0&&t.jsxs("div",{className:"mb-4 p-4 bg-gradient-to-r from-red-50 to-orange-50 dark:from-red-900/20 dark:to-orange-900/20 rounded-2xl",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[t.jsx($,{size:16,className:"text-red-500"}),t.jsx("span",{className:"font-bold text-sm text-red-700 dark:text-red-400",children:"저사용 구독 감지"})]}),t.jsxs("p",{className:"text-xs text-red-600/70 dark:text-red-400/70 mb-2",children:[d.length,"개 구독이 거의 사용되지 않고 있습니다"]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-wrap gap-1",children:[d.slice(0,3).map(e=>t.jsx("span",{className:"text-[10px] px-2 py-1 bg-white/50 dark:bg-dark-800/50 rounded-full text-red-600 dark:text-red-400",children:e.name},e.id)),d.length>3&&t.jsxs("span",{className:"text-[10px] text-red-500",children:["+",d.length-3,"개"]})]}),t.jsxs("span",{className:"text-sm font-bold text-red-600",children:["월 ₩",U.toLocaleString()," 낭비?"]})]})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("p",{className:"text-xs font-medium text-gray-600 dark:text-dark-300 mb-3",children:"오늘 사용한 서비스 체크하기"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:k.slice(0,6).map(e=>t.jsxs("button",{onClick:()=>!e.checkedToday&&D(e.id),disabled:e.checkedToday,className:`flex items-center gap-2 px-3 py-2 rounded-xl transition-all ${e.checkedToday?"bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400":"bg-gray-100 dark:bg-dark-700 text-gray-600 dark:text-dark-300 hover:bg-gray-200 dark:hover:bg-dark-600"}`,children:[e.checkedToday?t.jsx(z,{size:14}):t.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color||"#6366F1"}}),t.jsx("span",{className:"text-xs font-medium",children:e.name})]},e.id))})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("p",{className:"text-xs font-medium text-gray-600 dark:text-dark-300 mb-2",children:"구독별 사용 현황"}),k.map(e=>{var a;return t.jsxs("div",{className:"rounded-xl overflow-hidden",children:[t.jsxs("button",{onClick:()=>w(u===e.id?null:e.id),className:"w-full flex items-center gap-3 p-3 bg-gray-50 dark:bg-dark-700/50 hover:bg-gray-100 dark:hover:bg-dark-700 transition-colors",children:[t.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-white text-xs font-bold",style:{backgroundColor:e.color||"#6366F1"},children:(a=e.name)==null?void 0:a.charAt(0)}),t.jsxs("div",{className:"flex-1 text-left",children:[t.jsx("p",{className:"text-sm font-medium text-gray-800 dark:text-white",children:e.name}),t.jsx("p",{className:"text-xs text-gray-400",children:e.lastUsed?e.daysSinceLastUse===0?"오늘 사용함":`${e.daysSinceLastUse}일 전 사용`:"사용 기록 없음"})]}),t.jsxs("div",{className:`px-2 py-1 rounded-lg text-xs font-bold ${T(e.usageScore)}`,children:[e.usageScore,"점"]}),t.jsx("span",{className:`text-[10px] px-2 py-1 rounded-full ${e.status==="high"?"bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400":e.status==="medium"?"bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400":e.status==="low"?"bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400":"bg-gray-100 text-gray-600 dark:bg-dark-600 dark:text-dark-300"}`,children:A(e.status)}),u===e.id?t.jsx(F,{size:14,className:"text-gray-400"}):t.jsx(I,{size:14,className:"text-gray-400"})]}),u===e.id&&t.jsxs("div",{className:"p-4 bg-gray-100 dark:bg-dark-700",children:[t.jsx("p",{className:"text-xs text-gray-500 dark:text-dark-400 mb-3",children:"최근 12주 사용 기록"}),t.jsx("div",{className:"flex gap-1",children:C(p[e.id]||[]).map((l,n)=>t.jsx("div",{className:"flex flex-col gap-1",children:l.map((c,s)=>t.jsx("div",{className:`w-3 h-3 rounded-sm ${c.active?"bg-green-500":"bg-gray-200 dark:bg-dark-600"}`,title:c.date},s))},n))}),t.jsxs("div",{className:"flex items-center justify-between mt-3 text-[10px] text-gray-400",children:[t.jsx("span",{children:"12주 전"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("span",{children:"적음"}),t.jsxs("div",{className:"flex gap-0.5",children:[t.jsx("div",{className:"w-2 h-2 rounded-sm bg-gray-200 dark:bg-dark-600"}),t.jsx("div",{className:"w-2 h-2 rounded-sm bg-green-300"}),t.jsx("div",{className:"w-2 h-2 rounded-sm bg-green-500"})]}),t.jsx("span",{children:"많음"})]}),t.jsx("span",{children:"이번 주"})]})]})]},e.id)})]})]})}export{H as default};
