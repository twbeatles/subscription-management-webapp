import{j as e,f as q,B as C,v as H,l as P,aK as T,aL as A,aM as $,q as M}from"./vendor-ui-B6CU6qF1.js";import{r as o}from"./vendor-react-DtEkOSI3.js";import{u as I,l as R}from"./index-XBRr7Ttx.js";function B(k=[]){const{user:l}=I(),[d,s]=o.useState("default"),[g,u]=o.useState(!1),[m,N]=o.useState(null),[n,j]=o.useState({enabled:!0,paymentReminder:!0,paymentReminderDays:[3,1,0],trialExpiry:!0,trialExpiryDays:[3,1,0],budgetAlert:!0,budgetThreshold:80,quietHoursEnabled:!1,quietHoursStart:"22:00",quietHoursEnd:"08:00"});o.useEffect(()=>{const t="Notification"in window&&"serviceWorker"in navigator;u(t),t&&s(Notification.permission)},[]),o.useEffect(()=>{var t,a;if(l!=null&&l.id){const i=(a=(t=R).getNotificationSettings)==null?void 0:a.call(t,l.id);i&&j(x=>({...x,...i}))}},[l==null?void 0:l.id]),o.useEffect(()=>{g&&navigator.serviceWorker.register("/sw.js").then(t=>{console.log("[Push] SW registered:",t),N(t)}).catch(t=>{console.error("[Push] SW registration failed:",t)})},[g]);const w=o.useCallback(async()=>{if(!g)return console.warn("[Push] Notifications not supported"),!1;try{const t=await Notification.requestPermission();return s(t),t==="granted"}catch(t){return console.error("[Push] Permission request failed:",t),!1}},[g]),c=o.useCallback((t,a)=>{var i;if(!m||d!=="granted"){console.warn("[Push] Cannot send notification:",{swRegistration:!!m,permission:d});return}if(n.quietHoursEnabled){const x=new Date,f=`${x.getHours().toString().padStart(2,"0")}:${x.getMinutes().toString().padStart(2,"0")}`,{quietHoursStart:y,quietHoursEnd:b}=n;if(y<=b){if(f>=y&&f<b){console.log("[Push] Quiet hours active, skipping notification");return}}else if(f>=y||f<b){console.log("[Push] Quiet hours active, skipping notification");return}}(i=m.active)==null||i.postMessage({type:t,...a})},[m,d,n]),v=o.useCallback(()=>{if(!n.enabled||d!=="granted")return;const t=new Date;t.setHours(0,0,0,0),k.forEach(a=>{if(a.isPaused)return;const i=parseInt(a.billingDay)||1,x=t.getDate(),f=t.getMonth(),y=t.getFullYear();let b=new Date(y,f,i);i<x&&(b=new Date(y,f+1,i));const E=Math.ceil((b-t)/(1e3*60*60*24));if(n.paymentReminder&&n.paymentReminderDays.includes(E)&&c("PAYMENT_REMINDER",{subscription:a,daysUntil:E}),n.trialExpiry&&a.isTrial&&a.trialEndDate){const S=new Date(a.trialEndDate);S.setHours(0,0,0,0);const D=Math.ceil((S-t)/(1e3*60*60*24));n.trialExpiryDays.includes(D)&&c("TRIAL_EXPIRY",{subscription:a,daysRemaining:D})}})},[k,n,d,c]),r=o.useCallback((t,a)=>{if(!n.enabled||!n.budgetAlert||!a||a<=0)return;const i=Math.round(t/a*100);i>=n.budgetThreshold&&c("BUDGET_ALERT",{currentSpending:t,budget:a,percentUsed:i})},[n,c]),h=o.useCallback(t=>{var i,x;const a={...n,...t};j(a),l!=null&&l.id&&((x=(i=R).saveNotificationSettings)==null||x.call(i,l.id,a))},[n,l==null?void 0:l.id]),p=o.useCallback(()=>{var t;return!m||d!=="granted"?(console.warn("[Push] Cannot send test notification"),!1):((t=m.active)==null||t.postMessage({type:"SCHEDULE_NOTIFICATION",title:"ğŸ”” í…ŒìŠ¤íŠ¸ ì•Œë¦¼",body:"ì•Œë¦¼ì´ ì •ìƒì ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤!",tag:"test-notification",delay:0}),!0)},[m,d]);return{isSupported:g,permission:d,notificationSettings:n,requestPermission:w,updateSettings:h,checkAndNotify:v,checkBudgetAlert:r,sendTestNotification:p,sendNotification:c}}function W({subscriptions:k=[]}){const{isSupported:l,permission:d,notificationSettings:s,requestPermission:g,updateSettings:u,sendTestNotification:m}=B(k),[N,n]=o.useState(!1),j=async()=>{await g()||alert("ì•Œë¦¼ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ì•Œë¦¼ì„ í—ˆìš©í•´ì£¼ì„¸ìš”.")},w=()=>{m()&&(n(!0),setTimeout(()=>n(!1),3e3))},c=r=>{u({[r]:!s[r]})},v=(r,h,p)=>{const t="paymentReminderDays",a=s[t]||[];u(p?{[t]:[...a,h].sort((i,x)=>x-i)}:{[t]:a.filter(i=>i!==h)})};return l?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-2xl border border-gray-200 dark:border-dark-700 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[d==="granted"?e.jsx("div",{className:"w-10 h-10 bg-green-100 dark:bg-green-900/30 rounded-xl flex items-center justify-center",children:e.jsx(C,{className:"w-5 h-5 text-green-600 dark:text-green-400"})}):e.jsx("div",{className:"w-10 h-10 bg-gray-100 dark:bg-dark-700 rounded-xl flex items-center justify-center",children:e.jsx(H,{className:"w-5 h-5 text-gray-500 dark:text-dark-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"ì•Œë¦¼ ê¶Œí•œ"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-dark-400",children:d==="granted"?"ì•Œë¦¼ì´ í—ˆìš©ë˜ì–´ ìˆìŠµë‹ˆë‹¤":d==="denied"?"ì•Œë¦¼ì´ ì°¨ë‹¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤":"ì•Œë¦¼ ê¶Œí•œì„ ìš”ì²­í•´ì£¼ì„¸ìš”"})]})]}),d!=="granted"&&d!=="denied"&&e.jsx("button",{onClick:j,className:"px-4 py-2 bg-primary-600 text-white rounded-xl hover:bg-primary-700 transition-colors font-medium",children:"ê¶Œí•œ í—ˆìš©"}),d==="denied"&&e.jsx("span",{className:"text-sm text-red-500",children:"ë¸Œë¼ìš°ì € ì„¤ì •ì—ì„œ ë³€ê²½"})]}),d==="granted"&&e.jsx("div",{className:"mt-4 pt-4 border-t border-gray-100 dark:border-dark-700",children:e.jsx("button",{onClick:w,className:"flex items-center gap-2 px-4 py-2 bg-gray-100 dark:bg-dark-700 text-gray-700 dark:text-gray-300 rounded-xl hover:bg-gray-200 dark:hover:bg-dark-600 transition-colors",children:N?e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{children:"ì•Œë¦¼ ì „ì†¡ë¨!"})]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"w-4 h-4"}),e.jsx("span",{children:"í…ŒìŠ¤íŠ¸ ì•Œë¦¼ ë³´ë‚´ê¸°"})]})})})]}),d==="granted"&&e.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-2xl border border-gray-200 dark:border-dark-700 p-6 space-y-5",children:[e.jsxs("h3",{className:"font-semibold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx(C,{className:"w-5 h-5"}),"ì•Œë¦¼ ì¢…ë¥˜ ì„¤ì •"]}),e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 dark:bg-dark-700/50 rounded-xl",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:"ì „ì²´ ì•Œë¦¼"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-dark-400",children:"ëª¨ë“  ì•Œë¦¼ ì¼œê¸°/ë„ê¸°"})]}),e.jsx("button",{onClick:()=>c("enabled"),className:`w-12 h-6 rounded-full transition-colors ${s.enabled?"bg-primary-600":"bg-gray-300 dark:bg-dark-600"}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transition-transform ${s.enabled?"translate-x-6":"translate-x-0.5"}`})})]}),s.enabled&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:"ğŸ’³ ê²°ì œì¼ ì•Œë¦¼"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-dark-400",children:"ê²°ì œì¼ ì „ ë¯¸ë¦¬ ì•Œë¦¼"})]}),e.jsx("button",{onClick:()=>c("paymentReminder"),className:`w-12 h-6 rounded-full transition-colors ${s.paymentReminder?"bg-primary-600":"bg-gray-300 dark:bg-dark-600"}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transition-transform ${s.paymentReminder?"translate-x-6":"translate-x-0.5"}`})})]}),s.paymentReminder&&e.jsx("div",{className:"flex flex-wrap gap-2 ml-4",children:[7,3,1,0].map(r=>{var h;return e.jsx("button",{onClick:()=>{var p;return v("payment",r,!((p=s.paymentReminderDays)!=null&&p.includes(r)))},className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${(h=s.paymentReminderDays)!=null&&h.includes(r)?"bg-primary-100 dark:bg-primary-900/30 text-primary-700 dark:text-primary-400":"bg-gray-100 dark:bg-dark-700 text-gray-500 dark:text-dark-400"}`,children:r===0?"D-Day":`D-${r}`},r)})})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:"â° ë¬´ë£Œ ì²´í—˜ ë§Œë£Œ"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-dark-400",children:"ì²´í—˜ ì¢…ë£Œ ì „ ì•Œë¦¼"})]}),e.jsx("button",{onClick:()=>c("trialExpiry"),className:`w-12 h-6 rounded-full transition-colors ${s.trialExpiry?"bg-primary-600":"bg-gray-300 dark:bg-dark-600"}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transition-transform ${s.trialExpiry?"translate-x-6":"translate-x-0.5"}`})})]})}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:"ğŸ“Š ì˜ˆì‚° ì´ˆê³¼ ì•Œë¦¼"}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-dark-400",children:["ì˜ˆì‚°ì˜ ",s.budgetThreshold,"% ë„ë‹¬ ì‹œ ì•Œë¦¼"]})]}),e.jsx("button",{onClick:()=>c("budgetAlert"),className:`w-12 h-6 rounded-full transition-colors ${s.budgetAlert?"bg-primary-600":"bg-gray-300 dark:bg-dark-600"}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transition-transform ${s.budgetAlert?"translate-x-6":"translate-x-0.5"}`})})]}),s.budgetAlert&&e.jsxs("div",{className:"ml-4",children:[e.jsx("input",{type:"range",min:"50",max:"100",step:"10",value:s.budgetThreshold,onChange:r=>u({budgetThreshold:parseInt(r.target.value)}),className:"w-full accent-primary-600"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-dark-400 mt-1",children:[e.jsx("span",{children:"50%"}),e.jsx("span",{children:"80%"}),e.jsx("span",{children:"100%"})]})]})]})]})]}),d==="granted"&&s.enabled&&e.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-2xl border border-gray-200 dark:border-dark-700 p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[s.quietHoursEnabled?e.jsx(A,{className:"w-5 h-5 text-gray-500"}):e.jsx($,{className:"w-5 h-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:"ë°©í•´ ê¸ˆì§€ ì‹œê°„"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-dark-400",children:"ì§€ì • ì‹œê°„ëŒ€ ì•Œë¦¼ ë„ê¸°"})]})]}),e.jsx("button",{onClick:()=>c("quietHoursEnabled"),className:`w-12 h-6 rounded-full transition-colors ${s.quietHoursEnabled?"bg-primary-600":"bg-gray-300 dark:bg-dark-600"}`,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transition-transform ${s.quietHoursEnabled?"translate-x-6":"translate-x-0.5"}`})})]}),s.quietHoursEnabled&&e.jsxs("div",{className:"flex items-center gap-4 ml-8",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"w-4 h-4 text-gray-400"}),e.jsx("input",{type:"time",value:s.quietHoursStart,onChange:r=>u({quietHoursStart:r.target.value}),className:"px-3 py-1.5 bg-gray-100 dark:bg-dark-700 border-0 rounded-lg text-sm"})]}),e.jsx("span",{className:"text-gray-400",children:"~"}),e.jsx("input",{type:"time",value:s.quietHoursEnd,onChange:r=>u({quietHoursEnd:r.target.value}),className:"px-3 py-1.5 bg-gray-100 dark:bg-dark-700 border-0 rounded-lg text-sm"})]})]})]}):e.jsxs("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-2xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 text-yellow-700 dark:text-yellow-400",children:[e.jsx(q,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"ì´ ë¸Œë¼ìš°ì €ëŠ” ì•Œë¦¼ì„ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."})]}),e.jsx("p",{className:"mt-2 text-sm text-yellow-600 dark:text-yellow-500",children:"Chrome, Firefox, Safari ë“± ìµœì‹  ë¸Œë¼ìš°ì €ë¥¼ ì‚¬ìš©í•´ì£¼ì„¸ìš”."})]})}export{W as default};
