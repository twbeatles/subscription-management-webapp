import{j as e,e as D,ay as T,l as f,X as L,ai as I,E as M}from"./vendor-ui-B6CU6qF1.js";import{r as g}from"./vendor-react-DtEkOSI3.js";function P({subscriptions:y}){const[o,h]=g.useState([]),[N,i]=g.useState(null),[x,v]=g.useState(1440),d=g.useMemo(()=>y.filter(t=>!t.isPaused),[y]),u=t=>{const r=new Date,a=r.getDate(),l=r.getMonth(),c=r.getFullYear();let s;a<=t?s=new Date(c,l,t):s=new Date(c,l+1,t);const n=new Date(s.getFullYear(),s.getMonth()+1,0).getDate();return t>n&&s.setDate(n),s},m=t=>{const r=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0");return`${r}${a}${l}`},C=t=>{const r=u(t.billingDay),a=new Date(r);a.setDate(a.getDate()+1);const l=encodeURIComponent(`ğŸ’³ ${t.name} ê²°ì œì¼`),c=encodeURIComponent(`êµ¬ë… ì„œë¹„ìŠ¤: ${t.name}
ê²°ì œ ê¸ˆì•¡: ${t.cost.toLocaleString()}ì›
ê²°ì œì¼: ë§¤ì›” ${t.billingDay}ì¼

êµ¬ë… ê´€ë¦¬ ì•±ì—ì„œ ìë™ ìƒì„±ë¨`),s=`${m(r)}/${m(a)}`,n=encodeURIComponent("RRULE:FREQ=MONTHLY;COUNT=12");return`https://calendar.google.com/calendar/render?action=TEMPLATE&text=${l}&dates=${s}&details=${c}&recur=${n}`},E=t=>{h(r=>r.includes(t)?r.filter(a=>a!==t):[...r,t])},S=()=>{o.length===d.length?h([]):h(d.map(t=>t.id))},w=async(t,r)=>{try{if(navigator.clipboard&&window.isSecureContext)await navigator.clipboard.writeText(t);else{const a=document.createElement("textarea");a.value=t,a.style.position="fixed",a.style.left="-9999px",a.style.top="-9999px",document.body.appendChild(a),a.focus(),a.select(),document.execCommand("copy"),document.body.removeChild(a)}i(r),setTimeout(()=>i(null),2e3)}catch(a){console.error("Clipboard copy failed:",a),i("error"),setTimeout(()=>i(null),2e3)}},R=()=>{const t=o.length>0?d.filter(n=>o.includes(n.id)):d;if(t.length===0)return;let r=["BEGIN:VCALENDAR","VERSION:2.0","PRODID:-//SubscriptionManager//KR","CALSCALE:GREGORIAN"];const a=n=>n?String(n).replace(/\\/g,"\\\\").replace(/;/g,"\\;").replace(/,/g,"\\,").replace(/\n/g,"\\n"):"";t.forEach(n=>{const j=u(n.billingDay),$=m(j),p=new Date(j);p.setDate(p.getDate()+1);const A=m(p),k=new Date().toISOString().replace(/[-:]/g,"").split(".")[0]+"Z";let b="-P1D";x>=1440?b=`-P${Math.floor(x/1440)}D`:b=`-PT${x}M`,r.push("BEGIN:VEVENT",`DTSTART;VALUE=DATE:${$}`,`DTEND;VALUE=DATE:${A}`,"RRULE:FREQ=MONTHLY;COUNT=12",`DTSTAMP:${k}`,`UID:${n.id}_${k}@subscription-manager.com`,`SUMMARY:ğŸ’³ ${a(n.name)} ê²°ì œì¼`,`DESCRIPTION:êµ¬ë… ì„œë¹„ìŠ¤: ${a(n.name)}\\nê²°ì œ ê¸ˆì•¡: ${n.cost.toLocaleString()}ì›\\nê²°ì œì¼: ë§¤ì›” ${n.billingDay}ì¼`,"BEGIN:VALARM","ACTION:DISPLAY","DESCRIPTION:ê²°ì œì¼ ì•Œë¦¼",`TRIGGER:${b}`,"END:VALARM","END:VEVENT")}),r.push("END:VCALENDAR");const l=new Blob([r.join(`\r
`)],{type:"text/calendar;charset=utf-8"}),c=URL.createObjectURL(l),s=document.createElement("a");s.href=c,s.setAttribute("download","subscriptions_calendar.ics"),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(c)};return e.jsxs("section",{className:"bg-white dark:bg-dark-800 rounded-3xl shadow-sm border border-gray-100 dark:border-dark-700 overflow-hidden",children:[e.jsx("div",{className:"p-5 border-b border-gray-100 dark:border-dark-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-2xl flex items-center justify-center shadow-lg shadow-blue-500/30",children:e.jsx(D,{size:20,className:"text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-900 dark:text-white",children:"Google Calendar ì—°ë™"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-dark-400",children:"ê²°ì œì¼ì„ ìº˜ë¦°ë”ì— ì¶”ê°€í•˜ì„¸ìš”"})]})]})}),e.jsx("div",{className:"p-5 space-y-5",children:d.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500 dark:text-dark-400",children:[e.jsx(D,{size:32,className:"mx-auto mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"í™œì„±í™”ëœ êµ¬ë…ì´ ì—†ìŠµë‹ˆë‹¤"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/10 rounded-xl",children:e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:"ğŸ“… êµ¬ë… ê²°ì œì¼ì„ Google Calendarì— ì¶”ê°€í•˜ë©´ ê²°ì œ ì „ ì•Œë¦¼ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë§¤ì›” ë°˜ë³µ ì´ë²¤íŠ¸ë¡œ ìë™ ì„¤ì •ë©ë‹ˆë‹¤."})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:S,className:"text-sm text-gray-600 dark:text-dark-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors",children:[o.length===d.length?"ì „ì²´ í•´ì œ":"ì „ì²´ ì„ íƒ",e.jsxs("span",{className:"ml-1 text-xs text-gray-400",children:["(",o.length,"/",d.length,")"]})]}),o.length>0&&e.jsxs("button",{onClick:R,className:"px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-xl text-sm font-medium flex items-center gap-2 transition-colors",children:[e.jsx(T,{size:14}),"ìº˜ë¦°ë” íŒŒì¼ ë‹¤ìš´ë¡œë“œ (",o.length,")"]})]}),e.jsx("div",{className:"space-y-2",children:d.map(t=>{const r=o.includes(t.id),a=C(t),l=u(t.billingDay);return e.jsx("div",{className:`p-4 rounded-xl border-2 transition-all ${r?"border-blue-500 bg-blue-50 dark:bg-blue-900/10":"border-gray-200 dark:border-dark-600 bg-gray-50 dark:bg-dark-700"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>E(t.id),className:`w-5 h-5 rounded-md border-2 flex items-center justify-center transition-colors ${r?"bg-blue-500 border-blue-500":"border-gray-300 dark:border-dark-500"}`,children:r&&e.jsx(f,{size:12,className:"text-white"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium text-gray-900 dark:text-white text-sm truncate",children:t.name}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-dark-400",children:["ë§¤ì›” ",t.billingDay,"ì¼ â€¢ ë‹¤ìŒ ê²°ì œ: ",l.toLocaleDateString("ko-KR")]})]}),e.jsxs("div",{className:"text-sm font-medium text-gray-700 dark:text-dark-300",children:[t.cost.toLocaleString(),"ì›"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>w(a,t.id),className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-dark-300 transition-colors",title:"URL ë³µì‚¬",children:N===t.id?e.jsx(f,{size:16,className:"text-green-500"}):N==="error"?e.jsx(L,{size:16,className:"text-red-500"}):e.jsx(I,{size:16})}),e.jsx("a",{href:a,target:"_blank",rel:"noopener noreferrer",className:"p-2 text-blue-500 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-lg transition-colors",title:"Google Calendarì— ì¶”ê°€",children:e.jsx(M,{size:16})})]})]})},t.id)})}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-dark-700 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-700 dark:text-dark-300",children:"ê²°ì œ ì „ ì•Œë¦¼ ì‹œê°„"}),e.jsxs("select",{value:x,onChange:t=>v(parseInt(t.target.value)),className:"px-3 py-1.5 bg-white dark:bg-dark-600 border border-gray-200 dark:border-dark-500 rounded-lg text-sm",children:[e.jsx("option",{value:60,children:"1ì‹œê°„ ì „"}),e.jsx("option",{value:1440,children:"1ì¼ ì „"}),e.jsx("option",{value:2880,children:"2ì¼ ì „"}),e.jsx("option",{value:4320,children:"3ì¼ ì „"}),e.jsx("option",{value:10080,children:"1ì£¼ì¼ ì „"})]})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-dark-400 mt-2",children:"* ì•Œë¦¼ ì„¤ì •ì€ Google Calendarì—ì„œ ì´ë²¤íŠ¸ ì¶”ê°€ í›„ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."})]})]})})]})}export{P as default};
