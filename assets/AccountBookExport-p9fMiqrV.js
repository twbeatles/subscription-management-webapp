import{j as e,ax as F,F as $,l as O,ay as C}from"./vendor-ui-B6CU6qF1.js";import{r as o}from"./vendor-react-DtEkOSI3.js";import{C as x,A as g}from"./index-XBRr7Ttx.js";function L({subscriptions:i}){var f,u;const[c,k]=o.useState("toss"),[m,p]=o.useState(!1),[h,y]=o.useState(!1),[E,_]=o.useState("month"),j=o.useCallback(a=>{const r=i.filter(l=>!l.isPaused),n=new Date;switch(a){case"toss":return b(r,n);case"banksalad":return N(r,n);case"excel":return v(r,n);case"qif":return S(r,n);default:return b(r,n)}},[i]),b=(a,r)=>{const n=["거래일자","적요","출금","입금","잔액","메모"],l=a.map(t=>{const s=new Date(r);return s.setDate(t.billingDay||1),[s.toISOString().split("T")[0],`[구독] ${t.name}`,t.cost||0,0,"",x[t.category]||t.category]});return{content:[n,...l].map(t=>t.join(",")).join(`
`),filename:`toss_구독내역_${r.toISOString().split("T")[0]}.csv`,mimeType:"text/csv;charset=utf-8"}},N=(a,r)=>{const n=["날짜","시간","내용","카테고리","금액","메모","결제수단"],l=a.map(t=>{const s=new Date(r);return s.setDate(t.billingDay||1),[s.toISOString().split("T")[0],"00:00:00",t.name,"고정지출",`-${t.cost||0}`,x[t.category]||"",t.paymentMethodName||"미지정"]});return{content:[n,...l].map(t=>t.join(",")).join(`
`),filename:`banksalad_구독내역_${r.toISOString().split("T")[0]}.csv`,mimeType:"text/csv;charset=utf-8"}},v=(a,r)=>{const n=["서비스명","카테고리","월 결제액","연간 비용","결제일","결제주기","상태","메모","등록일"],l=a.map(s=>[s.name,x[s.category]||s.category,s.cost||0,(s.cost||0)*12,s.billingDay||"-",s.billingCycle==="yearly"?"연간":"월간",s.isPaused?"일시정지":"활성",s.memo||"",s.createdAt?new Date(s.createdAt).toISOString().split("T")[0]:"-"]),t=a.reduce((s,D)=>s+(D.cost||0),0);return l.push(["","","","","","","","",""]),l.push(["합계","",t,t*12,"","","","",""]),{content:[n,...l].map(s=>s.join(",")).join(`
`),filename:`구독관리_상세내역_${r.toISOString().split("T")[0]}.csv`,mimeType:"text/csv;charset=utf-8"}},S=(a,r)=>{let n=`!Type:Bank
`;return a.forEach(l=>{const t=new Date(r);t.setDate(l.billingDay||1);const s=`${t.getMonth()+1}/${t.getDate()}'${t.getFullYear().toString().slice(-2)}`;n+=`D${s}
`,n+=`T-${l.cost||0}
`,n+=`P${l.name}
`,n+=`L고정지출:구독
`,n+=`M${x[l.category]||l.category}
`,n+=`^
`}),{content:n,filename:`구독내역_${r.toISOString().split("T")[0]}.qif`,mimeType:"application/qif"}},w=o.useCallback(()=>{p(!0);try{const a=j(c),r=c!=="qif"?"\uFEFF":"",n=new Blob([r+a.content],{type:a.mimeType}),l=URL.createObjectURL(n),t=document.createElement("a");t.href=l,t.download=a.filename,document.body.appendChild(t),t.click(),document.body.removeChild(t),URL.revokeObjectURL(l),y(!0),setTimeout(()=>y(!1),3e3)}catch(a){console.error("Export failed:",a),alert("내보내기에 실패했습니다.")}finally{p(!1)}},[c,j]),d=i.filter(a=>!a.isPaused).length,T=i.filter(a=>!a.isPaused).reduce((a,r)=>a+(r.cost||0),0);return e.jsxs("section",{className:"bg-white dark:bg-dark-800 p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-dark-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-5",children:e.jsxs("h3",{className:"font-bold text-gray-900 dark:text-white flex items-center gap-2.5 text-base",children:[e.jsx("div",{className:"p-2 rounded-lg bg-teal-50 dark:bg-teal-900/20 text-teal-500",children:e.jsx(F,{className:"w-5 h-5"})}),"가계부 연동"]})}),e.jsx("div",{className:"p-4 bg-gray-50 dark:bg-dark-700/50 rounded-2xl mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-dark-400",children:"내보낼 구독"}),e.jsxs("p",{className:"text-lg font-bold text-gray-800 dark:text-white",children:[d,"개"]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-dark-400",children:"월 합계"}),e.jsxs("p",{className:"text-lg font-bold text-primary-600 dark:text-primary-400",children:["₩",T.toLocaleString()]})]})]})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600 dark:text-dark-300 mb-3",children:"내보내기 형식 선택"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(g).map(([a,r])=>e.jsxs("button",{onClick:()=>k(a),className:`p-4 rounded-2xl text-left transition-all ${c===a?"bg-primary-50 dark:bg-primary-900/20 border-2 border-primary-500":"bg-gray-50 dark:bg-dark-700/50 border-2 border-transparent hover:border-gray-200 dark:hover:border-dark-600"}`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-lg",children:r.icon}),e.jsx("span",{className:`text-sm font-medium ${c===a?"text-primary-600 dark:text-primary-400":"text-gray-800 dark:text-white"}`,children:r.name})]}),e.jsx("p",{className:"text-[10px] text-gray-400",children:r.description}),e.jsxs("p",{className:"text-[10px] text-gray-300 mt-1",children:[".",r.extension]})]},a))})]}),e.jsx("div",{className:"p-4 bg-blue-50 dark:bg-blue-900/20 rounded-2xl mb-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx($,{size:16,className:"text-blue-500 mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-medium text-blue-700 dark:text-blue-400 mb-1",children:[(f=g[c])==null?void 0:f.name," 형식"]}),e.jsxs("p",{className:"text-[10px] text-blue-600/70 dark:text-blue-400/70",children:[c==="toss"&&'토스 앱의 "가계부 > 설정 > 가져오기"에서 사용할 수 있습니다.',c==="banksalad"&&"뱅크샐러드 앱의 데이터 가져오기 기능과 호환됩니다.",c==="excel"&&"엑셀 또는 구글 스프레드시트에서 열 수 있는 상세 형식입니다.",c==="qif"&&"Quicken, Money 등 금융 소프트웨어에서 가져올 수 있습니다."]})]})]})}),e.jsx("button",{onClick:w,disabled:m||d===0,className:`w-full py-4 rounded-2xl font-medium transition-all flex items-center justify-center gap-2 ${h?"bg-green-500 text-white":m?"bg-gray-200 dark:bg-dark-600 text-gray-400":d===0?"bg-gray-200 dark:bg-dark-600 text-gray-400 cursor-not-allowed":"bg-primary-600 hover:bg-primary-700 text-white"}`,children:h?e.jsxs(e.Fragment,{children:[e.jsx(O,{size:18}),"다운로드 완료!"]}):m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin"}),"내보내는 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{size:18}),(u=g[c])==null?void 0:u.name," 형식으로 내보내기"]})}),d===0&&e.jsx("p",{className:"text-xs text-gray-400 text-center mt-2",children:"내보낼 활성 구독이 없습니다"})]})}export{L as default};
