import{j as t,i as O,g as R,a3 as L,e as B,T as D,d as $,aN as A}from"./vendor-ui-B6CU6qF1.js";import{r as i}from"./vendor-react-DtEkOSI3.js";import{u as F,l as p,a as E,C as P}from"./index-XBRr7Ttx.js";function _({subscriptions:x=[],totalMonthlyCost:h=0}){const{user:s}=F(),[m,v]=i.useState("comparison"),[G,I]=i.useState(new Date),f=i.useMemo(()=>{var e,r;return s!=null&&s.id?((r=(e=p).getReportHistory)==null?void 0:r.call(e,s.id))||[]:[]},[s==null?void 0:s.id]),b=i.useMemo(()=>{var e,r;return s!=null&&s.id?((r=(e=p).getUsageRecords)==null?void 0:r.call(e,s.id))||{}:{}},[s==null?void 0:s.id]),k=i.useMemo(()=>{var e,r;return s!=null&&s.id?((r=(e=p).getCategoryBudgets)==null?void 0:r.call(e,s.id))||{}:{}},[s==null?void 0:s.id]),l=i.useMemo(()=>{const e=[],r=new Date;for(let a=5;a>=0;a--){const d=new Date(r.getFullYear(),r.getMonth()-a,1),o=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`,n=f.find(g=>g.month===o),c=(n==null?void 0:n.totalCost)||(a===0?h:h*(.9+Math.random()*.2));e.push({month:d.toLocaleDateString("ko-KR",{month:"short"}),fullMonth:o,cost:Math.round(c),subscriptionCount:(n==null?void 0:n.subscriptionCount)||x.filter(g=>!g.isPaused).length,isCurrentMonth:a===0})}return e},[f,h,x]),u=i.useMemo(()=>{if(l.length<2)return{amount:0,percent:0};const e=l[l.length-1].cost,r=l[l.length-2].cost,a=e-r,d=r>0?a/r*100:0;return{amount:a,percent:Math.round(d)}},[l]),j=i.useMemo(()=>{const e={};return x.filter(r=>!r.isPaused).forEach(r=>{const a=r.category||"기타";e[a]||(e[a]={total:0,count:0,budget:k[a]||0}),e[a].total+=parseFloat(r.cost)||0,e[a].count+=1}),Object.entries(e).map(([r,a])=>({category:r,label:P[r]||r,color:E[r]||"#808080",...a,percentOfBudget:a.budget>0?Math.round(a.total/a.budget*100):null})).sort((r,a)=>a.total-r.total)},[x,k]),y=i.useMemo(()=>x.filter(e=>!e.isPaused).map(e=>{const d=(b[e.id]||[]).filter(g=>{const C=new Date(g);return new Date-C<=30*24*60*60*1e3}).length,o=parseFloat(e.cost)||1,n=d>0?o/d:o;let c;return d===0?c=0:n<=500?c=100:n<=1e3?c=90:n<=2e3?c=75:n<=5e3?c=50:c=Math.max(10,50-(n-5e3)/500),{...e,usageCount:d,costPerUse:Math.round(n),roiScore:Math.round(c),roiGrade:M(c)}}).sort((e,r)=>r.roiScore-e.roiScore),[x,b]),N=i.useMemo(()=>{const e=Array(31).fill(0).map((r,a)=>({day:a+1,count:0,subscriptions:[]}));return x.filter(r=>!r.isPaused).forEach(r=>{const a=parseInt(r.billingDay)||1;a>=1&&a<=31&&(e[a-1].count+=1,e[a-1].subscriptions.push(r))}),e},[x]),w=Math.max(...N.map(e=>e.count),1);function M(e){return e>=90?{label:"A",color:"#10B981"}:e>=75?{label:"B",color:"#60A5FA"}:e>=50?{label:"C",color:"#FBBF24"}:e>=25?{label:"D",color:"#F97316"}:{label:"F",color:"#EF4444"}}const S=[{id:"comparison",label:"월별 비교",icon:O},{id:"category",label:"카테고리 분석",icon:R},{id:"roi",label:"ROI 분석",icon:L},{id:"heatmap",label:"결제일 히트맵",icon:B}];return t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:S.map(e=>t.jsxs("button",{onClick:()=>v(e.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl font-medium whitespace-nowrap transition-colors ${m===e.id?"bg-primary-600 text-white":"bg-white dark:bg-dark-800 text-gray-600 dark:text-dark-400 hover:bg-gray-100 dark:hover:bg-dark-700"}`,children:[t.jsx(e.icon,{className:"w-4 h-4"}),e.label]},e.id))}),m==="comparison"&&t.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-3xl border border-gray-200 dark:border-dark-700 p-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-6",children:[t.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"월별 지출 비교"}),t.jsxs("div",{className:`flex items-center gap-1 px-3 py-1 rounded-full text-sm font-medium ${u.amount>=0?"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400":"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400"}`,children:[u.amount>=0?t.jsx(D,{className:"w-4 h-4"}):t.jsx($,{className:"w-4 h-4"}),t.jsxs("span",{children:[u.percent>=0?"+":"",u.percent,"%"]})]})]}),t.jsx("div",{className:"flex items-end justify-between gap-3 h-48 mb-4",children:l.map((e,r)=>{const a=Math.max(...l.map(o=>o.cost)),d=e.cost/a*100;return t.jsxs("div",{className:"flex-1 flex flex-col items-center group",children:[t.jsxs("div",{className:"relative w-full flex justify-center mb-2",children:[t.jsx("div",{className:`w-full max-w-12 rounded-t-lg transition-all ${e.isCurrentMonth?"bg-primary-500":"bg-gray-300 dark:bg-dark-600 group-hover:bg-gray-400 dark:group-hover:bg-dark-500"}`,style:{height:`${d*1.5}px`,minHeight:"20px"}}),t.jsxs("div",{className:"absolute -top-8 left-1/2 -translate-x-1/2 opacity-0 group-hover:opacity-100 transition-opacity bg-gray-900 dark:bg-dark-600 text-white text-xs px-2 py-1 rounded whitespace-nowrap",children:[e.cost.toLocaleString(),"원"]})]}),t.jsx("span",{className:`text-xs font-medium ${e.isCurrentMonth?"text-primary-600 dark:text-primary-400":"text-gray-500 dark:text-dark-400"}`,children:e.month})]},r)})}),t.jsxs("div",{className:"grid grid-cols-3 gap-4 pt-4 border-t border-gray-100 dark:border-dark-700",children:[t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-sm text-gray-500 dark:text-dark-400",children:"평균 지출"}),t.jsxs("div",{className:"text-lg font-bold text-gray-900 dark:text-white",children:[Math.round(l.reduce((e,r)=>e+r.cost,0)/l.length).toLocaleString(),"원"]})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-sm text-gray-500 dark:text-dark-400",children:"최고 지출"}),t.jsxs("div",{className:"text-lg font-bold text-red-600 dark:text-red-400",children:[Math.max(...l.map(e=>e.cost)).toLocaleString(),"원"]})]}),t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-sm text-gray-500 dark:text-dark-400",children:"최저 지출"}),t.jsxs("div",{className:"text-lg font-bold text-green-600 dark:text-green-400",children:[Math.min(...l.map(e=>e.cost)).toLocaleString(),"원"]})]})]})]}),m==="category"&&t.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-3xl border border-gray-200 dark:border-dark-700 p-6",children:[t.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-6",children:"카테고리별 지출 분석"}),t.jsx("div",{className:"space-y-4",children:j.map((e,r)=>t.jsxs("div",{className:"space-y-2",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:e.color}}),t.jsx("span",{className:"font-medium text-gray-900 dark:text-white",children:e.label}),t.jsxs("span",{className:"text-sm text-gray-500 dark:text-dark-400",children:["(",e.count,"개)"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("span",{className:"font-bold text-gray-900 dark:text-white",children:[e.total.toLocaleString(),"원"]}),e.percentOfBudget!==null&&t.jsxs("span",{className:`ml-2 text-sm ${e.percentOfBudget>100?"text-red-500":"text-gray-500 dark:text-dark-400"}`,children:["(",e.percentOfBudget,"%)"]})]})]}),t.jsx("div",{className:"h-2 bg-gray-100 dark:bg-dark-700 rounded-full overflow-hidden",children:t.jsx("div",{className:"h-full rounded-full transition-all",style:{width:`${Math.min(100,e.total/h*100)}%`,backgroundColor:e.color}})})]},r))}),j.length===0&&t.jsx("div",{className:"text-center text-gray-500 dark:text-dark-400 py-8",children:"활성화된 구독이 없습니다"})]}),m==="roi"&&t.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-3xl border border-gray-200 dark:border-dark-700 p-6",children:[t.jsxs("div",{className:"flex items-center gap-2 mb-6",children:[t.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white",children:"구독 ROI 분석"}),t.jsxs("div",{className:"relative group",children:[t.jsx(A,{className:"w-4 h-4 text-gray-400 cursor-help"}),t.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-2 bg-gray-900 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none",children:"ROI는 사용 빈도 대비 비용 효율성을 나타냅니다. 사용량을 기록할수록 정확해집니다."})]})]}),t.jsx("div",{className:"space-y-3",children:y.map((e,r)=>t.jsxs("div",{className:"flex items-center gap-4 p-4 bg-gray-50 dark:bg-dark-700/50 rounded-2xl",children:[t.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center font-bold text-white",style:{backgroundColor:e.roiGrade.color},children:e.roiGrade.label}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"font-medium text-gray-900 dark:text-white truncate",children:e.name}),t.jsxs("div",{className:"text-sm text-gray-500 dark:text-dark-400",children:["월 ",e.usageCount,"회 사용 · 1회당 ",e.costPerUse.toLocaleString(),"원"]})]}),t.jsxs("div",{className:"text-right",children:[t.jsxs("div",{className:"font-bold text-gray-900 dark:text-white",children:[e.cost.toLocaleString(),"원"]}),t.jsxs("div",{className:"text-xs text-gray-500 dark:text-dark-400",children:["ROI ",e.roiScore,"점"]})]})]},r))}),y.length===0&&t.jsx("div",{className:"text-center text-gray-500 dark:text-dark-400 py-8",children:"활성화된 구독이 없습니다"})]}),m==="heatmap"&&t.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-3xl border border-gray-200 dark:border-dark-700 p-6",children:[t.jsx("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-6",children:"결제일 분포 히트맵"}),t.jsx("div",{className:"grid grid-cols-7 gap-2 mb-4",children:["일","월","화","수","목","금","토"].map(e=>t.jsx("div",{className:"text-center text-xs text-gray-500 dark:text-dark-400 font-medium",children:e},e))}),t.jsx("div",{className:"grid grid-cols-7 gap-2",children:N.map((e,r)=>{const a=e.count/w,d=e.count===0?"bg-gray-100 dark:bg-dark-700":a>.66?"bg-red-500":a>.33?"bg-yellow-500":"bg-green-500";return t.jsxs("div",{className:`aspect-square rounded-lg flex flex-col items-center justify-center relative group cursor-pointer ${d} ${e.count>0?"text-white":"text-gray-400 dark:text-dark-500"}`,children:[t.jsx("span",{className:"text-sm font-medium",children:e.day}),e.count>0&&t.jsxs("span",{className:"text-xs opacity-80",children:[e.count,"개"]}),e.count>0&&t.jsxs("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-40 p-2 bg-gray-900 dark:bg-dark-600 text-white text-xs rounded-lg opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10",children:[t.jsxs("div",{className:"font-medium mb-1",children:[e.day,"일 결제"]}),e.subscriptions.map((o,n)=>t.jsxs("div",{className:"truncate",children:[o.name,": ",o.cost.toLocaleString(),"원"]},n))]})]},r)})}),t.jsxs("div",{className:"flex items-center justify-center gap-4 mt-6 text-sm",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-4 h-4 rounded bg-gray-100 dark:bg-dark-700"}),t.jsx("span",{className:"text-gray-500 dark:text-dark-400",children:"없음"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-4 h-4 rounded bg-green-500"}),t.jsx("span",{className:"text-gray-500 dark:text-dark-400",children:"1개"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-4 h-4 rounded bg-yellow-500"}),t.jsx("span",{className:"text-gray-500 dark:text-dark-400",children:"2개"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("div",{className:"w-4 h-4 rounded bg-red-500"}),t.jsx("span",{className:"text-gray-500 dark:text-dark-400",children:"3개+"})]})]})]})]})}export{_ as default};
