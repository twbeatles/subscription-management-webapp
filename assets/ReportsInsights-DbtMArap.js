import{T as v,d as y,g as L,i as j,j as e,ay as A,F as D}from"./vendor-ui-B6CU6qF1.js";import{r as i}from"./vendor-react-DtEkOSI3.js";import{u as R,l as T,C as m,a as f}from"./index-XBRr7Ttx.js";function _({subscriptions:c,totalMonthlyCost:o}){var u;const{user:g,isDemo:N}=R(),p=N?"demo_user":g==null?void 0:g.id,[O,P]=i.useState("month"),[x,k]=i.useState("overview"),w=i.useMemo(()=>T.getReportHistory(p),[p]),s=i.useMemo(()=>{const t=c.filter(r=>!r.isPaused),l=c.filter(r=>r.isPaused),a=o*12,n={};t.forEach(r=>{const d=r.category||"Etc";n[d]||(n[d]={count:0,cost:0}),n[d].count++,n[d].cost+=r.cost||0});const E=Object.entries(n).sort((r,d)=>d[1].cost-r[1].cost)[0],F=[...t].sort((r,d)=>(d.cost||0)-(r.cost||0))[0],S=t.length>0?Math.round(t.reduce((r,d)=>r+(d.cost||0),0)/t.length):0,h=o*.95,M=((o-h)/h*100).toFixed(1);return{totalActive:t.length,totalPaused:l.length,totalMonthly:o,totalYearly:a,categoryData:n,topCategory:E,mostExpensive:F,avgCost:S,monthChange:parseFloat(M),lastMonthCost:h}},[c,o]),b=i.useMemo(()=>{const t=[];return s.monthChange!==0&&t.push({type:s.monthChange>0?"warning":"success",icon:s.monthChange>0?v:y,title:s.monthChange>0?"ì§€ì¶œ ì¦ê°€":"ì§€ì¶œ ê°ì†Œ",message:`ì§€ë‚œ ë‹¬ ëŒ€ë¹„ ${Math.abs(s.monthChange)}% ${s.monthChange>0?"ì¦ê°€":"ê°ì†Œ"}í–ˆìŠµë‹ˆë‹¤`}),s.topCategory&&s.topCategory[1].cost>o*.5&&t.push({type:"warning",icon:L,title:"ì¹´í…Œê³ ë¦¬ ì§‘ì¤‘",message:`${m[s.topCategory[0]]||s.topCategory[0]}ì— ì§€ì¶œì˜ ${Math.round(s.topCategory[1].cost/o*100)}%ê°€ ì§‘ì¤‘ë˜ì–´ ìˆìŠµë‹ˆë‹¤`}),s.totalActive>10&&t.push({type:"info",icon:j,title:"êµ¬ë… ìˆ˜ ë§ìŒ",message:`${s.totalActive}ê°œì˜ í™œì„± êµ¬ë…ì´ ìˆìŠµë‹ˆë‹¤. ì •ë¦¬ê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤`}),t},[s,o]),C=()=>{const t=window.open("","_blank");if(!t)return;const l=`
            <!DOCTYPE html>
            <html><head><title>êµ¬ë… ë¦¬í¬íŠ¸</title>
            <style>
                body { font-family: -apple-system, sans-serif; padding: 40px; max-width: 800px; margin: 0 auto; }
                h1 { color: #6366F1; } h2 { color: #374151; margin-top: 30px; }
                .stat { display: inline-block; padding: 20px; background: #F3F4F6; border-radius: 12px; margin: 10px; min-width: 150px; }
                .stat-value { font-size: 24px; font-weight: bold; color: #111827; }
                .stat-label { font-size: 12px; color: #6B7280; }
                table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                th, td { padding: 12px; text-align: left; border-bottom: 1px solid #E5E7EB; }
                th { background: #F9FAFB; font-weight: 600; }
            </style></head><body>
            <h1>ğŸ“Š êµ¬ë… ê´€ë¦¬ ë¦¬í¬íŠ¸</h1>
            <p style="color:#6B7280">${new Date().toLocaleDateString("ko-KR",{year:"numeric",month:"long",day:"numeric"})}</p>
            
            <div class="stat"><div class="stat-value">${s.totalActive}ê°œ</div><div class="stat-label">í™œì„± êµ¬ë…</div></div>
            <div class="stat"><div class="stat-value">â‚©${s.totalMonthly.toLocaleString()}</div><div class="stat-label">ì›” ì§€ì¶œ</div></div>
            <div class="stat"><div class="stat-value">â‚©${s.totalYearly.toLocaleString()}</div><div class="stat-label">ì—°ê°„ ì§€ì¶œ</div></div>
            
            <h2>êµ¬ë… ëª©ë¡</h2>
            <table>
                <tr><th>ì„œë¹„ìŠ¤</th><th>ì¹´í…Œê³ ë¦¬</th><th>ì›” ë¹„ìš©</th><th>ìƒíƒœ</th></tr>
                ${c.map(a=>`
                    <tr>
                        <td>${a.name}</td>
                        <td>${m[a.category]||a.category}</td>
                        <td>â‚©${(a.cost||0).toLocaleString()}</td>
                        <td>${a.isPaused?"ì¼ì‹œì •ì§€":"í™œì„±"}</td>
                    </tr>
                `).join("")}
            </table>
            
            <h2>ì¹´í…Œê³ ë¦¬ë³„ ì§€ì¶œ</h2>
            <table>
                <tr><th>ì¹´í…Œê³ ë¦¬</th><th>êµ¬ë… ìˆ˜</th><th>ì›” ë¹„ìš©</th><th>ë¹„ìœ¨</th></tr>
                ${Object.entries(s.categoryData).map(([a,n])=>`
                    <tr>
                        <td>${m[a]||a}</td>
                        <td>${n.count}ê°œ</td>
                        <td>â‚©${n.cost.toLocaleString()}</td>
                        <td>${Math.round(n.cost/s.totalMonthly*100)}%</td>
                    </tr>
                `).join("")}
            </table>
            
            <script>window.print();<\/script>
            </body></html>
        `;t.document.write(l),t.document.close()},$=[{key:"overview",label:"ê°œìš”"},{key:"category",label:"ì¹´í…Œê³ ë¦¬"},{key:"trends",label:"íŠ¸ë Œë“œ"}];return e.jsxs("section",{className:"bg-white dark:bg-dark-800 p-6 rounded-3xl shadow-sm border border-gray-100 dark:border-dark-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-5",children:[e.jsxs("h3",{className:"font-bold text-gray-900 dark:text-white flex items-center gap-2.5 text-base",children:[e.jsx("div",{className:"p-2 rounded-lg bg-violet-50 dark:bg-violet-900/20 text-violet-500",children:e.jsx(j,{className:"w-5 h-5"})}),"ë¦¬í¬íŠ¸ & ì¸ì‚¬ì´íŠ¸"]}),e.jsxs("button",{onClick:C,className:"flex items-center gap-1 px-3 py-1.5 bg-violet-500 text-white text-xs font-medium rounded-lg hover:bg-violet-600",children:[e.jsx(A,{size:14}),"PDF"]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 mb-4",children:[e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-dark-700/50 rounded-xl text-center",children:[e.jsx("p",{className:"text-lg font-bold text-gray-800 dark:text-white",children:s.totalActive}),e.jsx("p",{className:"text-[10px] text-gray-400",children:"í™œì„±"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-dark-700/50 rounded-xl text-center",children:[e.jsxs("p",{className:"text-lg font-bold text-primary-600",children:["â‚©",(s.totalMonthly/1e3).toFixed(0),"k"]}),e.jsx("p",{className:"text-[10px] text-gray-400",children:"ì›”"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-dark-700/50 rounded-xl text-center",children:[e.jsxs("p",{className:"text-lg font-bold text-green-600",children:["â‚©",Math.round(s.totalYearly/1e4),"ë§Œ"]}),e.jsx("p",{className:"text-[10px] text-gray-400",children:"ì—°"})]}),e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-dark-700/50 rounded-xl text-center",children:[e.jsxs("p",{className:"text-lg font-bold text-orange-600",children:["â‚©",(s.avgCost/1e3).toFixed(1),"k"]}),e.jsx("p",{className:"text-[10px] text-gray-400",children:"í‰ê· "})]})]}),e.jsx("div",{className:"flex gap-2 mb-4",children:$.map(t=>e.jsx("button",{onClick:()=>k(t.key),className:`flex-1 py-2 rounded-xl text-xs font-medium transition-all ${x===t.key?"bg-violet-500 text-white":"bg-gray-100 dark:bg-dark-700 text-gray-600 dark:text-dark-300"}`,children:t.label},t.key))}),x==="overview"&&e.jsxs("div",{className:"space-y-3",children:[b.length>0&&e.jsx("div",{className:"space-y-2",children:b.map((t,l)=>e.jsxs("div",{className:`p-3 rounded-xl flex items-center gap-3 ${t.type==="warning"?"bg-orange-50 dark:bg-orange-900/20":t.type==="success"?"bg-green-50 dark:bg-green-900/20":"bg-blue-50 dark:bg-blue-900/20"}`,children:[e.jsx(t.icon,{size:18,className:t.type==="warning"?"text-orange-500":t.type==="success"?"text-green-500":"text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-medium text-gray-800 dark:text-white",children:t.title}),e.jsx("p",{className:"text-[10px] text-gray-500",children:t.message})]})]},l))}),s.mostExpensive&&e.jsxs("div",{className:"p-4 bg-gradient-to-r from-red-50 to-orange-50 dark:from-red-900/20 dark:to-orange-900/20 rounded-2xl",children:[e.jsx("p",{className:"text-xs text-red-600/70 mb-1",children:"ê°€ì¥ ë¹„ì‹¼ êµ¬ë…"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-lg flex items-center justify-center text-white text-xs font-bold",style:{backgroundColor:s.mostExpensive.color||"#EF4444"},children:(u=s.mostExpensive.name)==null?void 0:u.charAt(0)}),e.jsx("span",{className:"font-medium text-gray-800 dark:text-white",children:s.mostExpensive.name})]}),e.jsxs("span",{className:"text-lg font-bold text-red-600",children:["â‚©",(s.mostExpensive.cost||0).toLocaleString()]})]})]}),e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-dark-700/50 rounded-2xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("span",{className:"text-xs text-gray-500",children:"ì „ì›” ëŒ€ë¹„"}),e.jsxs("span",{className:`text-sm font-bold flex items-center gap-1 ${s.monthChange>0?"text-red-500":"text-green-500"}`,children:[s.monthChange>0?e.jsx(v,{size:14}):e.jsx(y,{size:14}),s.monthChange>0?"+":"",s.monthChange,"%"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("div",{className:"flex-1 p-2 bg-white dark:bg-dark-800 rounded-lg text-center",children:[e.jsx("p",{className:"text-[10px] text-gray-400",children:"ì§€ë‚œë‹¬"}),e.jsxs("p",{className:"text-sm font-medium",children:["â‚©",Math.round(s.lastMonthCost).toLocaleString()]})]}),e.jsxs("div",{className:"flex-1 p-2 bg-primary-50 dark:bg-primary-900/20 rounded-lg text-center",children:[e.jsx("p",{className:"text-[10px] text-primary-600",children:"ì´ë²ˆë‹¬"}),e.jsxs("p",{className:"text-sm font-bold text-primary-600",children:["â‚©",s.totalMonthly.toLocaleString()]})]})]})]})]}),x==="category"&&e.jsx("div",{className:"space-y-2",children:Object.entries(s.categoryData).sort((t,l)=>l[1].cost-t[1].cost).map(([t,l])=>{const a=Math.round(l.cost/s.totalMonthly*100);return e.jsxs("div",{className:"p-3 bg-gray-50 dark:bg-dark-700/50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:f[t]||"#6B7280"}}),e.jsx("span",{className:"text-sm font-medium text-gray-800 dark:text-white",children:m[t]||t}),e.jsxs("span",{className:"text-xs text-gray-400",children:[l.count,"ê°œ"]})]}),e.jsxs("span",{className:"text-sm font-bold",children:["â‚©",l.cost.toLocaleString()]})]}),e.jsx("div",{className:"h-2 bg-gray-200 dark:bg-dark-600 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full transition-all",style:{width:`${a}%`,backgroundColor:f[t]||"#6B7280"}})}),e.jsxs("p",{className:"text-[10px] text-gray-400 mt-1 text-right",children:[a,"%"]})]},t)})}),x==="trends"&&e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"p-4 bg-gray-50 dark:bg-dark-700/50 rounded-2xl",children:[e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"ì˜ˆìƒ ì—°ê°„ ì§€ì¶œ"}),e.jsx("div",{className:"space-y-2",children:[1,2,3].map(t=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-sm text-gray-600 dark:text-dark-300",children:[new Date().getFullYear()+t-1,"ë…„"]}),e.jsxs("span",{className:"text-sm font-medium text-gray-800 dark:text-white",children:["â‚©",Math.round(s.totalYearly*Math.pow(1.05,t-1)).toLocaleString()]})]},t))}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-2",children:"* ì—° 5% ì¸í”Œë ˆì´ì…˜ ê°€ì •"})]}),e.jsxs("div",{className:"p-4 bg-violet-50 dark:bg-violet-900/20 rounded-2xl",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(D,{size:16,className:"text-violet-500"}),e.jsx("span",{className:"text-sm font-medium text-violet-700 dark:text-violet-400",children:"ë¦¬í¬íŠ¸ íˆìŠ¤í† ë¦¬"})]}),e.jsxs("p",{className:"text-xs text-violet-600/70",children:[w.length,"ê°œì˜ ì›”ê°„ ìŠ¤ëƒ…ìƒ· ì €ì¥ë¨"]})]})]})]})}export{_ as default};
