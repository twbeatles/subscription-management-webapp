import{j as e,a0 as k,s as N,$ as v,e as w,q as S}from"./vendor-ui-B6CU6qF1.js";import{r as c}from"./vendor-react-DtEkOSI3.js";function E({subscriptions:h,userId:i}){const[n,p]=c.useState([]),[x,u]=c.useState("all");c.useEffect(()=>{if(i){const t=localStorage.getItem(`subscription_history_${i}`);t&&p(JSON.parse(t))}},[i]),c.useEffect(()=>{if(!i)return;const t=new Set(h.map(a=>a.id)),s=localStorage.getItem(`subscription_history_${i}`),d=s?JSON.parse(s):[],l=new Set(d.filter(a=>a.type==="added").map(a=>a.subscriptionId)),r=new Set(d.filter(a=>a.type==="removed").map(a=>a.subscriptionId));let o=[];if(h.forEach(a=>{l.has(a.id)||o.push({id:`event_${Date.now()}_${a.id}`,type:"added",subscriptionId:a.id,subscriptionName:a.name,cost:a.cost,category:a.category,color:a.customColor,date:a.createdAt||new Date().toISOString(),timestamp:Date.now()})}),l.forEach(a=>{if(!t.has(a)&&!r.has(a)){const m=d.find(y=>y.subscriptionId===a&&y.type==="added");m&&o.push({id:`event_${Date.now()}_removed_${a}`,type:"removed",subscriptionId:a,subscriptionName:m.subscriptionName,cost:m.cost,category:m.category,color:m.color,date:new Date().toISOString(),timestamp:Date.now()})}}),o.length>0){const a=[...d,...o].slice(-100);p(a),localStorage.setItem(`subscription_history_${i}`,JSON.stringify(a))}},[h,i]);const f=c.useMemo(()=>{let t=[...n];return x!=="all"&&(t=t.filter(s=>s.type===x)),t.sort((s,d)=>new Date(d.date)-new Date(s.date))},[n,x]),b=c.useMemo(()=>{const t={};return f.forEach(s=>{const d=new Date(s.date),l=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`,r=`${d.getFullYear()}년 ${d.getMonth()+1}월`;t[l]||(t[l]={label:r,events:[],added:0,removed:0,netChange:0}),t[l].events.push(s),s.type==="added"?(t[l].added+=s.cost||0,t[l].netChange+=s.cost||0):(t[l].removed+=s.cost||0,t[l].netChange-=s.cost||0)}),Object.entries(t).sort((s,d)=>d[0].localeCompare(s[0]))},[f]),g=c.useMemo(()=>{const t=n.filter(r=>r.type==="added").length,s=n.filter(r=>r.type==="removed").length,d=n.filter(r=>r.type==="added").reduce((r,o)=>r+(o.cost||0),0),l=n.filter(r=>r.type==="removed").reduce((r,o)=>r+(o.cost||0),0);return{totalAdded:t,totalRemoved:s,totalAddedCost:d,totalRemovedCost:l}},[n]),j=t=>{const s=new Date(t);return`${s.getMonth()+1}월 ${s.getDate()}일`};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-bold text-gray-900 dark:text-white flex items-center gap-2",children:[e.jsx("div",{className:"p-2 rounded-xl bg-indigo-100 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400",children:e.jsx(k,{size:20})}),"구독 히스토리"]}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-dark-400 mt-1",children:"구독 변경 내역과 지출 변화 추적"})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-emerald-50 dark:bg-emerald-900/20 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-emerald-600 dark:text-emerald-400 mb-1",children:[e.jsx(N,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:"추가된 구독"})]}),e.jsxs("p",{className:"text-2xl font-bold text-emerald-700 dark:text-emerald-300",children:[g.totalAdded,"개"]}),e.jsxs("p",{className:"text-xs text-emerald-600 dark:text-emerald-400 mt-1",children:["+₩",g.totalAddedCost.toLocaleString(),"/월"]})]}),e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 rounded-xl p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-red-600 dark:text-red-400 mb-1",children:[e.jsx(v,{size:16}),e.jsx("span",{className:"text-sm font-medium",children:"해지된 구독"})]}),e.jsxs("p",{className:"text-2xl font-bold text-red-700 dark:text-red-300",children:[g.totalRemoved,"개"]}),e.jsxs("p",{className:"text-xs text-red-600 dark:text-red-400 mt-1",children:["-₩",g.totalRemovedCost.toLocaleString(),"/월 절약"]})]})]}),e.jsx("div",{className:"flex gap-2",children:[{value:"all",label:"전체"},{value:"added",label:"추가"},{value:"removed",label:"해지"}].map(t=>e.jsx("button",{onClick:()=>u(t.value),className:`px-4 py-2 rounded-xl text-sm font-medium transition-colors ${x===t.value?"bg-indigo-600 text-white":"bg-gray-100 dark:bg-dark-700 text-gray-600 dark:text-dark-300 hover:bg-gray-200 dark:hover:bg-dark-600"}`,children:t.label},t.value))}),b.length>0?e.jsx("div",{className:"space-y-6",children:b.map(([t,s])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("h4",{className:"text-sm font-semibold text-gray-700 dark:text-dark-300 flex items-center gap-2",children:[e.jsx(w,{size:14}),s.label]}),e.jsxs("span",{className:`text-sm font-medium ${s.netChange>=0?"text-red-500":"text-emerald-500"}`,children:[s.netChange>=0?"+":"","₩",s.netChange.toLocaleString()]})]}),e.jsx("div",{className:"space-y-2 pl-4 border-l-2 border-gray-200 dark:border-dark-600",children:s.events.map(d=>{var l,r;return e.jsxs("div",{className:"relative pl-4 pb-3",children:[e.jsx("div",{className:`absolute -left-[9px] top-1 w-4 h-4 rounded-full border-2 border-white dark:border-dark-800 ${d.type==="added"?"bg-emerald-500":"bg-red-500"}`}),e.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-xl border border-gray-200 dark:border-dark-700 p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-lg flex items-center justify-center text-white font-bold text-sm",style:{backgroundColor:d.color||"#6366F1"},children:((l=d.subscriptionName)==null?void 0:l.charAt(0))||"?"}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-gray-900 dark:text-white text-sm",children:d.subscriptionName}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-dark-400",children:[j(d.date)," · ",d.type==="added"?"구독 시작":"구독 해지"]})]})]}),e.jsxs("span",{className:`text-sm font-medium ${d.type==="added"?"text-emerald-600 dark:text-emerald-400":"text-red-600 dark:text-red-400"}`,children:[d.type==="added"?"+":"-","₩",((r=d.cost)==null?void 0:r.toLocaleString())||0]})]})]},d.id)})})]},t))}):e.jsxs("div",{className:"text-center py-12 bg-gray-50 dark:bg-dark-700 rounded-2xl",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-gray-200 dark:bg-dark-600 text-gray-400 mb-4",children:e.jsx(S,{size:32})}),e.jsx("h4",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"기록이 없습니다"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-dark-400",children:"구독을 추가하거나 해지하면 여기에 기록됩니다."})]})]})}export{E as default};
