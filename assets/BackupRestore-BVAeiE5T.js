import{j as e,p as k,l as N,aO as G,q as I,ay as L,x as $,aP as S,n as _}from"./vendor-ui-B6CU6qF1.js";import{r as b}from"./vendor-react-DtEkOSI3.js";import{u as A,h as E,l as t}from"./index-XBRr7Ttx.js";function q({subscriptions:R=[]}){const{user:s}=A(),f=b.useRef(null),[x,c]=b.useState(null),[m,y]=b.useState(null),[u,M]=b.useState(()=>s!=null&&s.id?localStorage.getItem(`last_backup_${s.id}`):null),{confirm:D,ConfirmModalComponent:C}=E(),B=()=>{var r,d,n,o,l,i,a,j;if(s!=null&&s.id)try{const h={version:"1.0",createdAt:new Date().toISOString(),userId:s.id,userName:s.displayName,data:{subscriptions:t.getSubscriptions(s.id),settings:t.getUserSettings(s.id),tags:t.getTags(s.id),paymentMethods:t.getPaymentMethods(s.id),goals:((d=(r=t).getGoals)==null?void 0:d.call(r,s.id))||[],usageRecords:((o=(n=t).getUsageRecords)==null?void 0:o.call(n,s.id))||{},sharedMembers:((i=(l=t).getSharedMembers)==null?void 0:i.call(l,s.id))||{},categoryBudgets:((j=(a=t).getCategoryBudgets)==null?void 0:j.call(a,s.id))||{}}},O=new Blob([JSON.stringify(h,null,2)],{type:"application/json"}),v=URL.createObjectURL(O),g=document.createElement("a");g.href=v,g.download=`subscription_backup_${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(v);const w=new Date().toISOString();localStorage.setItem(`last_backup_${s.id}`,w),M(w),c({type:"success",message:"ë°±ì—… íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤."}),setTimeout(()=>c(null),3e3)}catch(h){console.error("Backup failed:",h),c({type:"error",message:"ë°±ì—… ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."})}},T=async r=>{var n,o;const d=(n=r.target.files)==null?void 0:n[0];if(!(!d||!(s!=null&&s.id))){try{const l=await d.text(),i=JSON.parse(l);if(!i.version||!i.data)throw new Error("ìœ íš¨í•˜ì§€ ì•Šì€ ë°±ì—… íŒŒì¼ì…ë‹ˆë‹¤.");const{data:a}=i;a.subscriptions&&t.saveSubscriptions(s.id,a.subscriptions),a.settings&&t.saveUserSettings(s.id,a.settings),a.tags&&t.saveTags(s.id,a.tags),a.paymentMethods&&t.savePaymentMethods(s.id,a.paymentMethods),a.goals&&t.saveGoals&&t.saveGoals(s.id,a.goals),a.usageRecords&&t.saveUsageRecords&&t.saveUsageRecords(s.id,a.usageRecords),a.sharedMembers&&t.saveSharedMembers&&t.saveSharedMembers(s.id,a.sharedMembers),a.categoryBudgets&&t.saveCategoryBudgets&&t.saveCategoryBudgets(s.id,a.categoryBudgets),y({type:"success",message:`ë³µêµ¬ ì™„ë£Œ! (${((o=a.subscriptions)==null?void 0:o.length)||0}ê°œ êµ¬ë…, ${i.createdAt.split("T")[0]} ë°±ì—…)`}),setTimeout(()=>{window.location.reload()},2e3)}catch(l){console.error("Restore failed:",l),y({type:"error",message:l.message||"ë³µêµ¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."})}r.target.value=""}},U=async()=>{if(!(!(s!=null&&s.id)||!await D({title:"ëª¨ë“  ë°ì´í„° ì‚­ì œ",message:"ì •ë§ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.",confirmText:"ì‚­ì œ",cancelText:"ì·¨ì†Œ",isDanger:!0})))try{t.saveSubscriptions(s.id,[]),t.saveTags(s.id,[]),t.savePaymentMethods(s.id,[]),t.saveGoals&&t.saveGoals(s.id,[]),t.saveUsageRecords&&t.saveUsageRecords(s.id,{}),t.saveSharedMembers&&t.saveSharedMembers(s.id,{}),c({type:"success",message:"ëª¨ë“  ë°ì´í„°ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤."}),setTimeout(()=>{window.location.reload()},1500)}catch(d){console.error("Clear failed:",d),c({type:"error",message:"ë°ì´í„° ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤."})}},p=u?Math.floor((Date.now()-new Date(u).getTime())/(1e3*60*60*24)):null;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-6",children:[p!==null&&p>=7&&e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-2xl p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-yellow-800 dark:text-yellow-300",children:["ë§ˆì§€ë§‰ ë°±ì—…ì´ ",p,"ì¼ ì „ì…ë‹ˆë‹¤"]}),e.jsx("p",{className:"text-sm text-yellow-700 dark:text-yellow-400",children:"ë°ì´í„° ì†ì‹¤ ë°©ì§€ë¥¼ ìœ„í•´ ì •ê¸°ì ì¸ ë°±ì—…ì„ ê¶Œì¥í•©ë‹ˆë‹¤."})]})]})}),x&&e.jsxs("div",{className:`rounded-2xl p-4 flex items-center gap-3 ${x.type==="success"?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400"}`,children:[x.type==="success"?e.jsx(N,{className:"w-5 h-5"}):e.jsx(k,{className:"w-5 h-5"}),x.message]}),m&&e.jsxs("div",{className:`rounded-2xl p-4 flex items-center gap-3 ${m.type==="success"?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400":"bg-red-50 dark:bg-red-900/20 text-red-700 dark:text-red-400"}`,children:[m.type==="success"?e.jsx(N,{className:"w-5 h-5"}):e.jsx(k,{className:"w-5 h-5"}),m.message]}),e.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-3xl border border-gray-200 dark:border-dark-700 overflow-hidden",children:[e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-xl flex items-center justify-center",children:e.jsx(G,{className:"w-5 h-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"ë¡œì»¬ ë°±ì—…"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-dark-400",children:"JSON íŒŒì¼ë¡œ ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸°"})]})]}),u&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-500 dark:text-dark-400 mb-4",children:[e.jsx(I,{className:"w-4 h-4"}),"ë§ˆì§€ë§‰ ë°±ì—…: ",new Date(u).toLocaleString("ko-KR")]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("button",{onClick:B,className:"flex items-center justify-center gap-2 py-3 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 font-medium rounded-xl hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors",children:[e.jsx(L,{className:"w-5 h-5"}),"ë°±ì—… ìƒì„±"]}),e.jsxs("button",{onClick:()=>{var r;return(r=f.current)==null?void 0:r.click()},className:"flex items-center justify-center gap-2 py-3 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 font-medium rounded-xl hover:bg-green-200 dark:hover:bg-green-900/50 transition-colors",children:[e.jsx($,{className:"w-5 h-5"}),"ë³µêµ¬í•˜ê¸°"]})]}),e.jsx("input",{ref:f,type:"file",accept:".json",onChange:T,className:"hidden"})]}),e.jsx("div",{className:"px-6 py-4 bg-gray-50 dark:bg-dark-700/50 border-t border-gray-100 dark:border-dark-700",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-dark-400",children:"í˜„ì¬ ì €ì¥ëœ ë°ì´í„°"}),e.jsxs("span",{className:"font-medium text-gray-900 dark:text-white",children:["êµ¬ë… ",R.length,"ê°œ"]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-3xl border border-gray-200 dark:border-dark-700 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 dark:bg-purple-900/30 rounded-xl flex items-center justify-center",children:e.jsx(S,{className:"w-5 h-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"í´ë¼ìš°ë“œ ë°±ì—…"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-dark-400",children:"Google Drive ì—°ë™"})]})]}),e.jsx("div",{className:"bg-purple-50 dark:bg-purple-900/10 rounded-xl p-4 mb-4",children:e.jsx("p",{className:"text-sm text-purple-700 dark:text-purple-400",children:"ğŸ”’ Google Drive ì—°ë™ì€ í˜„ì¬ ê°œë°œ ì¤‘ì…ë‹ˆë‹¤. ì¶œì‹œ ì•Œë¦¼ì„ ë°›ìœ¼ì‹œë ¤ë©´ ì•Œë¦¼ ì„¤ì •ì„ ì¼œì£¼ì„¸ìš”."})}),e.jsxs("button",{disabled:!0,className:"w-full py-3 bg-gray-100 dark:bg-dark-700 text-gray-400 dark:text-dark-500 font-medium rounded-xl cursor-not-allowed flex items-center justify-center gap-2",children:[e.jsx(S,{className:"w-5 h-5"}),"Google Drive ì—°ê²° (ì¤€ë¹„ ì¤‘)"]})]}),e.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-3xl border border-red-200 dark:border-red-900/50 p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:"w-10 h-10 bg-red-100 dark:bg-red-900/30 rounded-xl flex items-center justify-center",children:e.jsx(_,{className:"w-5 h-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-red-700 dark:text-red-400",children:"ìœ„í—˜ ì˜ì—­"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-dark-400",children:"ë³µêµ¬í•  ìˆ˜ ì—†ëŠ” ì‘ì—…"})]})]}),e.jsx("button",{onClick:U,className:"w-full py-3 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 font-medium rounded-xl hover:bg-red-200 dark:hover:bg-red-900/50 transition-colors",children:"ëª¨ë“  ë°ì´í„° ì‚­ì œ"})]})]}),C]})}export{q as default};
