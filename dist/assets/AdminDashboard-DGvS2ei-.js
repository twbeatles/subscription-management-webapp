import{j as e,H as E,b as L,K as M,N as u,C as q,T as Q,h as T,O as k,Q as $,R as K}from"./vendor-ui-xJyZwkfJ.js";import{u as B,r as i}from"./vendor-react-DAxIwopO.js";import{n as F,q as H,p as O,z as V,f as v,w as j}from"./vendor-firebase-cSXO_zK6.js";import{u as X,d as p}from"./index-M6CRROlJ.js";function Y(){const c=B(),{isAdmin:x,user:y}=X(),[m,h]=i.useState([]),[f,N]=i.useState(!0),[l,w]=i.useState(""),[n,C]=i.useState({totalUsers:0,totalSubscriptions:0,totalMonthlyRevenue:0,activeUsers:0});i.useEffect(()=>{if(!x){c("/");return}D()},[x,c]);const D=async()=>{try{const s=F(p,"users"),t=H(s,O("createdAt","desc")),r=(await V(t)).docs.map(d=>({id:d.id,...d.data()}));h(r);const o=r.reduce((d,b)=>d+(b.subscriptionCount||0),0),R=r.reduce((d,b)=>d+(b.totalMonthlyCost||0),0),S=r.filter(d=>!d.isDisabled).length;C({totalUsers:r.length,totalSubscriptions:o,totalMonthlyRevenue:R,activeUsers:S})}catch(s){console.error("Error fetching users:",s)}finally{N(!1)}},U=async(s,t)=>{try{const a=v(p,"users",s);await j(a,{isDisabled:!t}),h(m.map(r=>r.id===s?{...r,isDisabled:!t}:r))}catch(a){console.error("Error updating user:",a)}},z=async(s,t)=>{if(s===y.uid){alert("자신의 관리자 권한은 변경할 수 없습니다");return}try{const a=v(p,"users",s);await j(a,{isAdmin:!t}),h(m.map(r=>r.id===s?{...r,isAdmin:!t}:r))}catch(a){console.error("Error updating user:",a)}},g=m.filter(s=>{var t,a;return((t=s.email)==null?void 0:t.toLowerCase().includes(l.toLowerCase()))||((a=s.displayName)==null?void 0:a.toLowerCase().includes(l.toLowerCase()))}),A=s=>{if(!s)return"-";const t=s.toDate?s.toDate():new Date(s);return new Intl.DateTimeFormat("ko-KR",{year:"numeric",month:"short",day:"numeric"}).format(t)};return x?e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-dark-900 pb-8",children:[e.jsx("div",{className:"bg-gradient-to-br from-amber-600 to-orange-600 text-white",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-6",children:[e.jsxs("button",{onClick:()=>c("/"),className:"flex items-center gap-2 text-white/80 hover:text-white mb-4 text-sm",children:[e.jsx(E,{size:18}),"돌아가기"]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 bg-white/10 rounded-xl flex items-center justify-center",children:e.jsx(L,{size:24})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold",children:"관리자 대시보드"}),e.jsx("p",{className:"text-white/70 text-sm",children:"사용자 및 시스템 관리"})]})]})]})}),e.jsxs("div",{className:"max-w-4xl mx-auto px-4 -mt-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-6",children:[e.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-2xl p-4 shadow-sm border border-gray-100 dark:border-dark-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-dark-400 mb-2",children:[e.jsx(M,{size:16}),e.jsx("span",{className:"text-xs",children:"총 사용자"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:n.totalUsers})]}),e.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-2xl p-4 shadow-sm border border-gray-100 dark:border-dark-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-dark-400 mb-2",children:[e.jsx(u,{size:16}),e.jsx("span",{className:"text-xs",children:"활성 사용자"})]}),e.jsx("div",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:n.activeUsers})]}),e.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-2xl p-4 shadow-sm border border-gray-100 dark:border-dark-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-dark-400 mb-2",children:[e.jsx(q,{size:16}),e.jsx("span",{className:"text-xs",children:"총 구독 수"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:n.totalSubscriptions})]}),e.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-2xl p-4 shadow-sm border border-gray-100 dark:border-dark-700",children:[e.jsxs("div",{className:"flex items-center gap-2 text-gray-500 dark:text-dark-400 mb-2",children:[e.jsx(Q,{size:16}),e.jsx("span",{className:"text-xs",children:"총 월 지출"})]}),e.jsxs("div",{className:"text-2xl font-bold text-primary-600 dark:text-primary-400",children:[Math.round(n.totalMonthlyRevenue/1e4),"만"]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-dark-800 rounded-2xl shadow-sm border border-gray-100 dark:border-dark-700 overflow-hidden",children:[e.jsxs("div",{className:"p-4 border-b border-gray-100 dark:border-dark-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"font-bold text-gray-900 dark:text-white",children:"사용자 목록"}),e.jsxs("span",{className:"text-xs text-gray-400 dark:text-dark-500",children:[g.length,"명"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(T,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"이메일 또는 이름으로 검색...",value:l,onChange:s=>w(s.target.value),className:"w-full pl-10 pr-4 py-2.5 rounded-xl border border-gray-200 dark:border-dark-600 bg-gray-50 dark:bg-dark-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-primary-500 outline-none text-sm"})]})]}),f?e.jsx("div",{className:"p-8 text-center",children:e.jsx("div",{className:"w-8 h-8 border-3 border-primary-200 border-t-primary-600 rounded-full animate-spin mx-auto"})}):e.jsxs("div",{className:"divide-y divide-gray-100 dark:divide-dark-700",children:[g.map(s=>{var t,a,r,o;return e.jsxs("div",{className:"p-4 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-dark-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center text-white font-medium ${s.isDisabled?"bg-gray-400":"bg-primary-500"}`,children:((a=(t=s.displayName)==null?void 0:t[0])==null?void 0:a.toUpperCase())||((o=(r=s.email)==null?void 0:r[0])==null?void 0:o.toUpperCase())||"?"}),e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:`font-medium truncate ${s.isDisabled?"text-gray-400 line-through":"text-gray-900 dark:text-white"}`,children:s.displayName||"이름 없음"}),s.isAdmin&&e.jsx(k,{size:12,className:"text-amber-500 flex-shrink-0"})]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-dark-400 truncate",children:s.email})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"hidden md:block text-right",children:[e.jsxs("div",{className:"text-sm text-gray-600 dark:text-dark-300",children:[s.subscriptionCount||0,"개 구독"]}),e.jsxs("div",{className:"text-xs text-gray-400 dark:text-dark-500",children:["가입: ",A(s.createdAt)]})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("button",{className:"p-2 hover:bg-gray-100 dark:hover:bg-dark-600 rounded-lg transition-colors",children:e.jsx($,{size:16,className:"text-gray-400"})}),e.jsxs("div",{className:"absolute right-0 top-full mt-1 w-40 bg-white dark:bg-dark-700 rounded-xl shadow-lg border border-gray-100 dark:border-dark-600 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-10",children:[e.jsxs("button",{onClick:()=>z(s.id,s.isAdmin),className:"w-full px-4 py-2.5 text-left text-sm text-gray-700 dark:text-dark-300 hover:bg-gray-50 dark:hover:bg-dark-600 flex items-center gap-2 first:rounded-t-xl",children:[e.jsx(k,{size:14}),s.isAdmin?"관리자 해제":"관리자 지정"]}),e.jsxs("button",{onClick:()=>U(s.id,s.isDisabled),className:`w-full px-4 py-2.5 text-left text-sm flex items-center gap-2 last:rounded-b-xl ${s.isDisabled?"text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20":"text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20"}`,children:[s.isDisabled?e.jsx(u,{size:14}):e.jsx(K,{size:14}),s.isDisabled?"계정 활성화":"계정 비활성화"]})]})]})]})]},s.id)}),g.length===0&&e.jsx("div",{className:"p-8 text-center text-gray-400 dark:text-dark-500",children:l?"검색 결과가 없습니다":"사용자가 없습니다"})]})]})]})]}):null}export{Y as default};
